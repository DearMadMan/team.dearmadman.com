<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Team.dearmadman.com">
<meta property="og:url" content="http://yoursite.com/page/10/index.html">
<meta property="og:site_name" content="Team.dearmadman.com">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Team.dearmadman.com">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/10/"/>





  <title>Team.dearmadman.com</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Team.dearmadman.com</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Just do it.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/21/what-is-jwt/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dearmadman">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Team.dearmadman.com">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/21/what-is-jwt/" itemprop="url">什么是 JWT -- JSON WEB TOKEN</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-04-21T17:16:54+08:00">
                2016-04-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="什么是JWT"><a href="#什么是JWT" class="headerlink" title="什么是JWT"></a>什么是JWT</h1><blockquote>
<p>Json web token (JWT), 是为了在网络应用环境间传递声明而执行的一种基于JSON的开放标准（<a href="https://tools.ietf.org/html/rfc7519" target="_blank" rel="external">(RFC 7519</a>).该token被设计为紧凑且安全的，特别适用于分布式站点的单点登录（SSO）场景。JWT的声明一般被用来在身份提供者和服务提供者间传递被认证的用户身份信息，以便于从资源服务器获取资源，也可以增加一些额外的其它业务逻辑所必须的声明信息，该token也可直接被用于认证，也可被加密。</p>
</blockquote>
<h2 id="起源"><a href="#起源" class="headerlink" title="起源"></a>起源</h2><p>说起JWT，我们应该来谈一谈基于token的认证和传统的session认证的区别。</p>
<h3 id="传统的session认证"><a href="#传统的session认证" class="headerlink" title="传统的session认证"></a>传统的session认证</h3><p>我们知道，http协议本身是一种无状态的协议，而这就意味着如果用户向我们的应用提供了用户名和密码来进行用户认证，那么下一次请求时，用户还要再一次进行用户认证才行，因为根据http协议，我们并不能知道是哪个用户发出的请求，所以为了让我们的应用能识别是哪个用户发出的请求，我们只能在服务器存储一份用户登录的信息，这份登录信息会在响应时传递给浏览器，告诉其保存为cookie,以便下次请求时发送给我们的应用，这样我们的应用就能识别请求来自哪个用户了,这就是传统的基于session认证。</p>
<p>但是这种基于session的认证使应用本身很难得到扩展，随着不同客户端用户的增加，独立的服务器已无法承载更多的用户，而这时候基于session认证应用的问题就会暴露出来.</p>
<h4 id="基于session认证所显露的问题"><a href="#基于session认证所显露的问题" class="headerlink" title="基于session认证所显露的问题"></a>基于session认证所显露的问题</h4><p><strong>Session</strong>: 每个用户经过我们的应用认证之后，我们的应用都要在服务端做一次记录，以方便用户下次请求的鉴别，通常而言session都是保存在内存中，而随着认证用户的增多，服务端的开销会明显增大。</p>
<p><strong>扩展性</strong>: 用户认证之后，服务端做认证记录，如果认证的记录被保存在内存中的话，这意味着用户下次请求还必须要请求在这台服务器上,这样才能拿到授权的资源，这样在分布式的应用上，相应的限制了负载均衡器的能力。这也意味着限制了应用的扩展能力。</p>
<p><strong>CSRF</strong>: 因为是基于cookie来进行用户识别的, cookie如果被截获，用户就会很容易受到跨站请求伪造的攻击。</p>
<h2 id="基于token的鉴权机制"><a href="#基于token的鉴权机制" class="headerlink" title="基于token的鉴权机制"></a>基于token的鉴权机制</h2><p>基于token的鉴权机制类似于http协议也是无状态的，它不需要在服务端去保留用户的认证信息或者会话信息。这就意味着基于token认证机制的应用不需要去考虑用户在哪一台服务器登录了，这就为应用的扩展提供了便利。</p>
<p>流程上是这样的：</p>
<ul>
<li>用户使用用户名密码来请求服务器</li>
<li>服务器进行验证用户的信息</li>
<li>服务器通过验证发送给用户一个token</li>
<li>客户端存储token，并在每次请求时附送上这个token值</li>
<li>服务端验证token值，并返回数据</li>
</ul>
<p>这个token必须要在每次请求时传递给服务端，它应该保存在请求头里， 另外，服务端要支持<code>CORS(跨来源资源共享)</code>策略，一般我们在服务端这么做就可以了<code>Access-Control-Allow-Origin: *</code>。</p>
<p>那么我们现在回到JWT的主题上。</p>
<h2 id="JWT长什么样？"><a href="#JWT长什么样？" class="headerlink" title="JWT长什么样？"></a>JWT长什么样？</h2><p>JWT是由三段信息文本构成的, 这三段信息文本用<code>.</code>链接一起就构成了Jwt字符串。就像这样:</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">eyJhbGciOiJIUzI<span class="number">1</span><span class="symbol">NiIsInR5</span>cCI<span class="number">6</span>IkpX<span class="attr">VCJ9</span>.eyJzdWIiOiIxMj<span class="name">M0</span><span class="symbol">NTY3</span>ODkwIiwibmFtZSI<span class="number">6</span>Ikpva<span class="name">G4</span>gR<span class="name">G9</span>lIiwiYWRtaW<span class="number">4</span>iO<span class="symbol">nRydWV9</span>.TJVA<span class="number">95</span><span class="keyword">Or</span><span class="name">M7</span>E<span class="number">2</span>cBab<span class="number">30</span>RMHrHDcEfxjoYZgeFO<span class="symbol">NFh7</span>HgQ</div></pre></td></tr></table></figure>
<h2 id="JWT的构成"><a href="#JWT的构成" class="headerlink" title="JWT的构成"></a>JWT的构成</h2><p>第一部分我们称它为头部（header),第二部分我们称其为载荷（payload, 类似于飞机上承载的物品)，第三部分是签证（signature).</p>
<h3 id="header"><a href="#header" class="headerlink" title="header"></a>header</h3><p>jwt的头部承载两部分信息：</p>
<ul>
<li>声明类型，这里是jwt</li>
<li>声明加密的算法 通常直接使用 HMAC SHA256</li>
</ul>
<p>完整的头部就像下面这样的JSON：<br><figure class="highlight xquery"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="string">'typ'</span>: <span class="string">'JWT'</span>,</div><div class="line">  <span class="string">'alg'</span>: <span class="string">'HS256'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后将头部进行base64加密（该加密是可以对称解密的),构成了第一部分. </p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">eyJ<span class="number">0</span>eXAiOiJKV<span class="number">1</span>QiLCJhbGciOiJIUzI<span class="number">1</span><span class="symbol">NiJ9</span></div></pre></td></tr></table></figure>
<h3 id="playload"><a href="#playload" class="headerlink" title="playload"></a>playload</h3><p>载荷就是存放有效信息的地方。这个名字像是特指飞机上承载的货品，这些有效信息包含三个部分</p>
<ul>
<li>标准中注册的声明</li>
<li>公共的声明</li>
<li>私有的声明</li>
</ul>
<p><strong>标准中注册的声明</strong> (建议但不强制使用) ：</p>
<ul>
<li><strong>iss</strong>: jwt签发者</li>
<li><strong>sub</strong>: jwt所面向的用户</li>
<li><strong>aud</strong>: 接收jwt的一方</li>
<li><strong>exp</strong>: jwt的过期时间，这个过期时间必须要大于签发时间</li>
<li><strong>nbf</strong>: 定义在什么时间之前，该jwt都是不可用的.</li>
<li><strong>iat</strong>: jwt的签发时间</li>
<li><strong>jti</strong>: jwt的唯一身份标识，主要用来作为一次性token,从而回避重放攻击。</li>
</ul>
<p><strong>公共的声明</strong> ：<br>公共的声明可以添加任何的信息，一般添加用户的相关信息或其他业务需要的必要信息.但不建议添加敏感信息，因为该部分在客户端可解密.</p>
<p><strong>私有的声明</strong> ：<br>私有声明是提供者和消费者所共同定义的声明，一般不建议存放敏感信息，因为base64是对称解密的，意味着该部分信息可以归类为明文信息。</p>
<p>定义一个payload:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"sub"</span>: <span class="string">"1234567890"</span>,</div><div class="line">  <span class="attr">"name"</span>: <span class="string">"John Doe"</span>,</div><div class="line">  <span class="attr">"admin"</span>: <span class="literal">true</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后将其进行base64加密，得到Jwt的第二部分。</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">eyJzdWIiOiIxMj<span class="name">M0</span><span class="symbol">NTY3</span>ODkwIiwibmFtZSI<span class="number">6</span>Ikpva<span class="name">G4</span>gR<span class="name">G9</span>lIiwiYWRtaW<span class="number">4</span>iO<span class="symbol">nRydWV9</span></div></pre></td></tr></table></figure>
<h3 id="signature"><a href="#signature" class="headerlink" title="signature"></a>signature</h3><p>jwt的第三部分是一个签证信息，这个签证信息由三部分组成：</p>
<ul>
<li>header (base64后的)</li>
<li>payload (base64后的)</li>
<li>secret</li>
</ul>
<p>这个部分需要base64加密后的header和base64加密后的payload使用<code>.</code>连接组成的字符串，然后通过header中声明的加密方式进行加盐<code>secret</code>组合加密，然后就构成了jwt的第三部分。</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// javascript</span></div><div class="line"><span class="built_in">var</span> encodedString = base64UrlEncode(<span class="keyword">header</span>) + <span class="string">'.'</span> + base64UrlEncode(payload);</div><div class="line"></div><div class="line"><span class="built_in">var</span> signature = HMACSHA256(encodedString, <span class="string">'secret'</span>); <span class="comment">// TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ</span></div></pre></td></tr></table></figure>
<p>将这三部分用<code>.</code>连接成一个完整的字符串,构成了最终的jwt:<br><figure class="highlight gcode"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">eyJhbGciOiJIUzI<span class="number">1</span><span class="symbol">NiIsInR5</span>cCI<span class="number">6</span>IkpX<span class="attr">VCJ9</span>.eyJzdWIiOiIxMj<span class="name">M0</span><span class="symbol">NTY3</span>ODkwIiwibmFtZSI<span class="number">6</span>Ikpva<span class="name">G4</span>gR<span class="name">G9</span>lIiwiYWRtaW<span class="number">4</span>iO<span class="symbol">nRydWV9</span>.TJVA<span class="number">95</span><span class="keyword">Or</span><span class="name">M7</span>E<span class="number">2</span>cBab<span class="number">30</span>RMHrHDcEfxjoYZgeFO<span class="symbol">NFh7</span>HgQ</div></pre></td></tr></table></figure></p>
<p><strong>注意：secret是保存在服务器端的，jwt的签发生成也是在服务器端的，secret就是用来进行jwt的签发和jwt的验证，所以，它就是你服务端的私钥，在任何场景都不应该流露出去。一旦客户端得知这个secret, 那就意味着客户端是可以自我签发jwt了。</strong></p>
<h3 id="如何应用"><a href="#如何应用" class="headerlink" title="如何应用"></a>如何应用</h3><p>一般是在请求头里加入<code>Authorization</code>，并加上<code>Bearer</code>标注：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">fetch</span>(<span class="string">'api/user/1'</span>, &#123;</div><div class="line">  <span class="attribute">headers</span>: &#123;</div><div class="line">    <span class="string">'Authorization'</span>: <span class="string">'Bearer '</span> + token</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>服务端会验证token，如果验证通过就会返回相应的资源。整个流程就是这样的:</p>
<p><img src="/jwt-diagram.png" alt="jwt-diagram"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul>
<li>因为json的通用性，所以JWT是可以进行跨语言支持的，像JAVA,JavaScript,NodeJS,PHP等很多语言都可以使用。</li>
<li>因为有了payload部分，所以JWT可以在自身存储一些其他业务逻辑所必要的非敏感信息。</li>
<li>便于传输，jwt的构成非常简单，字节占用很小，所以它是非常便于传输的。</li>
<li>它不需要在服务端保存会话信息, 所以它易于应用的扩展</li>
</ul>
<h3 id="安全相关"><a href="#安全相关" class="headerlink" title="安全相关"></a>安全相关</h3><ul>
<li>不应该在jwt的payload部分存放敏感信息，因为该部分是客户端可解密的部分。</li>
<li>保护好secret私钥，该私钥非常重要。</li>
<li>如果可以，请使用https协议</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/19/laravel-from-scratch-routing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dearmadman">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Team.dearmadman.com">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/19/laravel-from-scratch-routing/" itemprop="url">laravel 基础教程 —— 路由</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-04-19T16:28:42+08:00">
                2016-04-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h1><blockquote>
<p>路由（routing）就是通过互联的网络把信息从源地址传输到目的地址的活动。路由发生在OSI网络参考模型中的第三层即网络层。</p>
</blockquote>
<h2 id="基础路由"><a href="#基础路由" class="headerlink" title="基础路由"></a>基础路由</h2><p>一般所有的路由都被定义在<code>app/Http/routes.php</code>文件中，其中的内容会被框架自动加载，大多数的基础路由都可以通过简单的传递资源表述地址和<code>Closure</code>闭包函数来进行定义。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Route::get(<span class="string">'foo'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="string">'Hello world!'</span>;  </div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="基础路由文件"><a href="#基础路由文件" class="headerlink" title="基础路由文件"></a>基础路由文件</h3><p><code>routes.php</code>路由文件是在 <code>app\Providers\RouteServiceProvider.php</code>中被加载的，在被加载的同时使用了<code>web</code>中间件组（version&gt;=5.2), 这个中间件组被定义在<code>app\Http\kernel.php</code>的<code>$middlewareGroups</code>变量中，该中间件组提供了cookie加密、cookie响应、session启用、自动注入error session 到视图、csrf保护的功能。你的应用程序的大多数路由都应该定义在这个路由文件里。</p>
<h3 id="可用的路由方法"><a href="#可用的路由方法" class="headerlink" title="可用的路由方法"></a>可用的路由方法</h3><p>路由允许你在注册路由时使用任何http请求方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Route::get($uri, $callback);</div><div class="line">Route::post($uri, $callback);</div><div class="line">Route::put($uri, $callback);</div><div class="line">Route::patch($uri, $callback);</div><div class="line">Route::delete($uri, $callback);</div><div class="line">Route::options($uri, $callback);</div></pre></td></tr></table></figure>
<p>有时候你可能需要在注册路由时允许多种请求方式，这个时候你可能需要使用<code>method</code>方法，当然你可以使用<code>any</code>方法允许任何请求方式:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Route::match([<span class="string">'get'</span>, <span class="string">'post'</span>], <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">  <span class="comment">// </span></div><div class="line">&#125;);</div><div class="line"></div><div class="line">Route::any(<span class="string">'foo'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">  <span class="comment">//</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h2 id="带参数的路由"><a href="#带参数的路由" class="headerlink" title="带参数的路由"></a>带参数的路由</h2><h3 id="必要参数的路由"><a href="#必要参数的路由" class="headerlink" title="必要参数的路由"></a>必要参数的路由</h3><p>有时候你可能需要捕获路由中的某个片段，比如说用户的id, 那么你就可以定义带参数的路由：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Route::get(<span class="string">'user/&#123;id&#125;'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($id)</span> </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="string">'user_id is: '</span> . $id;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p> 可能你需要获取到路由中的多个参数, 那么你可以这么做: </p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Route::get(<span class="string">'posts/&#123;post&#125;/comments/&#123;comment&#125;'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($post, $comment)</span> </span>&#123;</div><div class="line"> <span class="comment">//</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p> 路由参数就是定义在<code>{}</code>里的，每当该路由被访问到，相关注册的参数就会被按序的传递进闭包函数里.</p>
<p> <code>ps: 路由参数不能含 **-** ，应该使用 **_** 代替，比如 {user_id}</code></p>
<h3 id="可选的参数的路由"><a href="#可选的参数的路由" class="headerlink" title="可选的参数的路由"></a>可选的参数的路由</h3><p>有时候你可能需要定义一个带参数的路由，但是这个参数可有可无，没有的话，可以给予一个默认值，那么这时候就需要用 <code>{name?}</code>的方式来定义可选路由了：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Route::get(<span class="string">'user/&#123;name?&#125;'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($name = null)</span> </span>&#123;</div><div class="line">  <span class="keyword">return</span> $name; </div><div class="line">&#125;);</div><div class="line"></div><div class="line">Route::get(<span class="string">'user/&#123;name?&#125;'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($name = <span class="string">'john'</span>)</span></span>&#123;</div><div class="line"> <span class="keyword">return</span> $name; </div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="用正则表达式约束参数"><a href="#用正则表达式约束参数" class="headerlink" title="用正则表达式约束参数"></a>用正则表达式约束参数</h3><p>你可以使用正则表达式去约束你的参数，这里你可以使用<code>where</code>方法，当参数与约束规则不匹配时就不会匹配到该路由：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Route::get(<span class="string">'user/&#123;name&#125;'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($name)</span></span>&#123;</div><div class="line">  <span class="comment">//</span></div><div class="line">&#125;)</div><div class="line">-&gt;where(<span class="string">'name'</span>, <span class="string">'[a-zA-Z]+'</span>);</div><div class="line">Route::get(<span class="string">'user/&#123;id&#125;'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($id)</span></span>&#123;</div><div class="line"> <span class="comment">// </span></div><div class="line">&#125;)</div><div class="line">-&gt;where(<span class="string">'id'</span>, <span class="string">'[0-9]+'</span>);</div><div class="line">Route::get(<span class="string">'user/&#123;id&#125;/&#123;name&#125;'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($id, $name)</span></span>&#123;</div><div class="line">  <span class="comment">//</span></div><div class="line">&#125;)</div><div class="line">-&gt;where([<span class="string">'id'</span> =&gt; <span class="string">'[0-9]+'</span>, <span class="string">'name'</span> =&gt; <span class="string">'[a-zA-Z]+'</span>);</div></pre></td></tr></table></figure>
<h4 id="全局的约束表达式"><a href="#全局的约束表达式" class="headerlink" title="全局的约束表达式"></a>全局的约束表达式</h4><p>你可以定义全局的约束表达式，这样所有匹配到的路由参数都会受到相同的约束条件, 这个时候你需要在路由启动之前就有注册好约束，你需要在路由服务提供者文件里在启动路由前增加约束。文件是<code>app\Providers\RouteServiceProvider.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span><span class="params">(Router $router)</span> </span>&#123;</div><div class="line">  $router-&gt;pattern(<span class="string">'id'</span>, <span class="string">'[0-9]+'</span>);</div><div class="line"></div><div class="line">  <span class="keyword">parent</span>::boot($router);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>当然，在5.2版本里，路由服务提供者在引入<code>router.php</code>文件时已经注入了<code>$router</code>变量，所以你也可以在<code>router.php</code>文件里这么提供批量约束表达式 :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$router-&gt;pattern(<span class="string">'id'</span>,<span class="string">'[0-9]+'</span>);</div><div class="line"></div><div class="line">Route::get(<span class="string">'user/&#123;id&#125;'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($id)</span> </span>&#123;</div><div class="line"> <span class="comment">// </span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>但是要注意注册的前后顺序，只有在注册之后引入的路由才受约束，而在 <code>$router-pattern(&#39;id&#39;, &#39;[0-9]+&#39;)</code> 之前注册的路由是不受约束的.</p>
<h2 id="命名路由"><a href="#命名路由" class="headerlink" title="命名路由"></a>命名路由</h2><p>命名路由可以方便的生成资源表述地址，可以方便的将路由重定向到指定的路由地址。你可以在注册路由时，传递第二个参数为数组参数，并添加<code>as</code>索引：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Route::get(<span class="string">'user/profile'</span>, [<span class="string">'as'</span> =&gt; <span class="string">'profile'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">  <span class="comment">//</span></div><div class="line">&#125;]);</div></pre></td></tr></table></figure></p>
<p>当然你也可以命名使用控制器行为的路由：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Route::get(<span class="string">'user/profile'</span>, [<span class="string">'as'</span> =&gt; <span class="string">'profile'</span>, <span class="string">'use'</span> =&gt; <span class="string">'UserController@showProfile'</span>]);</div></pre></td></tr></table></figure></p>
<p>有时候数组写起来比较麻烦，我们还可以使用<code>name</code>方法去命名路由，当然它是支持链式调用的:<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Route::get(<span class="string">'user/profile'</span>, <span class="string">'UserController@showProfile'</span>)-&gt;name(<span class="string">'profile'</span>);</div></pre></td></tr></table></figure></p>
<h3 id="路由组-amp-命名组路由"><a href="#路由组-amp-命名组路由" class="headerlink" title="路由组 &amp; 命名组路由"></a>路由组 &amp; 命名组路由</h3><p>如果你使用了路由组，你可能想在整个组中增加一个组命名前缀，当然，laravel是支持这么做的：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Route::group([<span class="string">'as'</span> =&gt; <span class="string">'admin::'</span>], <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">  Route::get(<span class="string">'dashboard'</span>, [<span class="string">'as'</span> =&gt; <span class="string">'dashboard'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// route named 'admin::dashboard'</span></div><div class="line">    <span class="comment">// you can redirect to this use route('admin::dashboard')</span></div><div class="line">  &#125;]) ;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h3 id="使用命名路由生成urls"><a href="#使用命名路由生成urls" class="headerlink" title="使用命名路由生成urls"></a>使用命名路由生成urls</h3><p>一旦你命名了一个路由，那么你就可以使用全局帮助函数<code>route</code>来生成路由url地址，也可以用来做为重定向时生成重定向地址:<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Generating URLs...</span></div><div class="line">$url = route(<span class="string">'profile'</span>);</div><div class="line"></div><div class="line"><span class="comment">// Generating Redirects...</span></div><div class="line"><span class="keyword">return</span> redirect()-&gt;route(<span class="string">'profile'</span>);</div></pre></td></tr></table></figure></p>
<p>如果你是对一个参数路由进行命名，那么你可以在使用<code>route</code>方法获取路由url时传递第二个参数，该参数是一个数组，你所传递的参数会正确的按索引匹配到相应的位置,如果参数索引与路由参数不一致，则会优先匹配相同的参数存放到相应位置，不一致的会按序存入：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Route::get(<span class="string">'user/&#123;id&#125;/profile'</span>, [<span class="string">'as'</span> =&gt; <span class="string">'profile'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($id)</span> </span>&#123;</div><div class="line"> <span class="comment">// </span></div><div class="line">&#125;]);</div><div class="line">$url = route(<span class="string">'profile'</span>, [<span class="string">'id'</span> =&gt; <span class="number">1</span>]);</div></pre></td></tr></table></figure></p>
<h2 id="路由组"><a href="#路由组" class="headerlink" title="路由组"></a>路由组</h2><p>路由组的使用方便共享路由的一些能力，比如共享中间件，或者命名空间，这样就不必每一个路由都要单独去定义一次相同的中间件或命名空间。路由组使用 <code>Route::group</code>去定义，并共享第一个参数中的能力.该参数为数组.</p>
<h3 id="共享中间件"><a href="#共享中间件" class="headerlink" title="共享中间件"></a>共享中间件</h3><p>你可以使用<code>middleware</code>索引来建立共享中间件,这样路由组内定义的路由都会在匹配时引入该中间件:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Route::group([<span class="string">'middleware'</span> =&gt; <span class="string">'auth'</span>], <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">  Route::get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// Uses Auth Middleware</span></div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  Route::get(<span class="string">'user/profile'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// Uses Auth Middleware</span></div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="共享命名空间"><a href="#共享命名空间" class="headerlink" title="共享命名空间"></a>共享命名空间</h3><p>路由组另外一个常用的例子就是在控制器中共享命名空间，这个时候就要用到了<code>namespace</code>索引:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Route::group([<span class="string">'namespace'</span> =&gt; <span class="string">'Admin'</span>], <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">   <span class="comment">// Controllers Within The 'App\Http\Controllers\Admin' Namespace </span></div><div class="line"></div><div class="line">   Route::group([<span class="string">'namespace'</span> =&gt; <span class="string">'User'</span>], <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">     <span class="comment">//  Controllers Within The 'App\Http\Controllers\Admin\User' Namespace</span></div><div class="line">   &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>因为我们大部分路由都是定义在<code>routes.php</code>文件里，而路由服务在提供服务时将该文件引入到路由组中,并共享了<code>App\Http\Controllers</code>命名空间，这样，在该文件中定义的控制器路由，可以不使用<code>App\Http\Controllers</code>前缀.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Already Within The 'App\Http\Controllers' Namespace</span></div><div class="line">Route::get(<span class="string">'user/profile'</span>, <span class="string">'UserController@showProfile'</span>);</div></pre></td></tr></table></figure>
<h3 id="子域名路由"><a href="#子域名路由" class="headerlink" title="子域名路由"></a>子域名路由</h3><p>子域名路由可以做域名匹配路由，也就是说可以约束域名做匹配，如果不是匹配到的域名则不会注册该组内路由， 当然你可以对子域名进行类参数路由的约束，这样允许你捕获域名的一部分或全部:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Route::group([<span class="string">'domain'</span> =&gt; <span class="string">'&#123;account&#125;.myapp.com'</span>], <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">  Route::get(<span class="string">'user/&#123;id&#125;'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($account, $id)</span> </span>&#123;</div><div class="line">    <span class="comment">//</span></div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="路由前缀"><a href="#路由前缀" class="headerlink" title="路由前缀"></a>路由前缀</h3><p>使用<code>prefix</code>索引可以在路由组中定义路由前缀，这样在该组内的路由都会自动使用该前缀：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Route::group([<span class="string">'prefix'</span> =&gt; <span class="string">'admin'</span>], <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">  Route::get(<span class="string">'dashboard'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// Matches The 'admin/dashboard' URL</span></div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>当然你可以在路由前缀中使用参数：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Route::group([<span class="string">'prefix'</span> =&gt; <span class="string">'accounts/&#123;account_id&#125;'</span>], <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">  Route::get(<span class="string">'detail'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($account_id)</span> </span>&#123;</div><div class="line">    <span class="comment">// Matchs The '/accounts/&#123;account_id&#125;/detail' URL</span></div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h2 id="CSRF-保护"><a href="#CSRF-保护" class="headerlink" title="CSRF 保护"></a>CSRF 保护</h2><blockquote>
<p>跨站请求伪造（英语：Cross-site request forgery），也被称为 one-click attack 或者 session riding，通常缩写为 CSRF 或者 XSRF， 是一种挟制用户在当前已登录的Web应用程序上执行非本意的操作的攻击方法。跟跨网站脚本（XSS）相比，XSS 利用的是用户对指定网站的信任，CSRF 利用的是网站对用户网页浏览器的信任。<br>跨站请求攻击，简单地说，是攻击者通过一些技术手段欺骗用户的浏览器去访问一个自己曾经认证过的网站并执行一些操作（如发邮件，发消息，甚至财产操作如转账和购买商品）。由于浏览器曾经认证过，所以被访问的网站会认为是真正的用户操作而去执行。这利用了web中用户身份验证的一个漏洞：简单的身份验证只能保证请求发自某个用户的浏览器，却不能保证请求本身是用户自愿发出的。</p>
</blockquote>
<p>laravel框架自带csrf攻击保护措施，它被以中间件的形式引入到<code>web</code>路由组中，所以每个在<code>routes.php</code>文件中定义的路由被访问时都会经过csrf中间件的验证。你可以查看<code>vendor/laravel/framework/src/Illuminate/Foundation/Http/Middleware/VerifyCsrfToken.php</code>文件，阅读其实现。<br><code>csrf(跨站请求伪造)</code>是一种恶意的攻击行为，它可以绕过用户的授权去执行未授权的行为。</p>
<p>laravel会为每个活跃用户生成一个csrf token,而这个token就是用来验证请求是不是真实用户授权的。所以你应该在每个表单中都使用隐藏的input并录入csrf token,这样提交表单的请求才能通过csrf中间件的验证.<br>laravel提供了方便的形式去在表单中生成csrf token:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Vanilla PHP</span></div><div class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> csrf_field(); <span class="meta">?&gt;</span></div><div class="line"></div><div class="line"><span class="comment">// Blade Template Syntax</span></div><div class="line">&#123;&#123; csrf_field() &#125;&#125;</div></pre></td></tr></table></figure>
<p><code>csrf_field()</code>方法会生成以下html节点：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;input type=<span class="string">"hidden"</span> name=<span class="string">"_token"</span> value=<span class="string">"&lt;?php echo csrf_token(); ?&gt;"</span>&gt;</div></pre></td></tr></table></figure>
<p>你并不需要去手动的验证这些能够修改状态的http请求，比如 post, put, delete, 因为VerifyCsrfToken中间件已经自动处理这些请求了，它会自动的根据请求中的token与会话中存储的token进行匹配验证。</p>
<h3 id="排除csrf保护"><a href="#排除csrf保护" class="headerlink" title="排除csrf保护"></a>排除csrf保护</h3><p>有时候我们可能需要排除个别url，让他不受csrf的保护，因为可能我们需要挂接一些其他的第三方系统，这个时候系统之间的通讯是不应该使用csrf机制去验证的，比如说，你使用了支付宝的即时付款机制，那么在用户付款的时候服务器与服务器之间会有一个回馈机制，用于支付宝通知我们的应用用户已经成功付款，这个时候我们可能需要排除csrf对反馈路由的保护。那么我们可以在<code>VerifyCsrfToken</code>中间件中修改<code>$except</code>属性中增加一条规则:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"></div><div class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Middleware</span>;</div><div class="line"></div><div class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Http</span>\<span class="title">Middleware</span>\<span class="title">VerifyCsrfToken</span> <span class="title">as</span> <span class="title">BaseVerifier</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">VerifyCsrfToken</span> <span class="keyword">extends</span> <span class="title">BaseVerifier</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">   <span class="comment">/** </span></div><div class="line"><span class="comment">    * The URIs that should be excluded from CSRF verification.</span></div><div class="line"><span class="comment">    * </span></div><div class="line"><span class="comment">    * <span class="doctag">@var</span> array</span></div><div class="line"><span class="comment">    */</span></div><div class="line">   <span class="keyword">protected</span> $except = [</div><div class="line">    <span class="string">'alipay/*'</span>,</div><div class="line">   ];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="X-CSRF-TOKEN"><a href="#X-CSRF-TOKEN" class="headerlink" title="X-CSRF-TOKEN"></a>X-CSRF-TOKEN</h3><p>laravel的<code>VerifyCsrfToken</code>中间件不仅允许通过表单中验证_token参数，它也允许通过请求头去进行csrf验证，它会验证请求头中的<code>X-CSRF-TOKEN</code>值是否与会话的token值匹配，所以你可以这么做，存储token到<code>meta</code>中：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"csrf-token"</span> <span class="attr">content</span>=<span class="string">"&#123;&#123; csrf_token() &#125;&#125;"</span> &gt;</span></div></pre></td></tr></table></figure></p>
<p>一旦你定义了<code>meta</code>标签，你可以使用像<code>jquery</code>类似的框架去添加token到所有请求的头部:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$.ajaxSetup(&#123;</div><div class="line">  headers: &#123;</div><div class="line">    <span class="string">'X-CSRF-TOKEN'</span>: $(<span class="string">'meta[name="csrf-token"]'</span>).attr(<span class="string">'content'</span>)</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="X-XSRF-TOKEN"><a href="#X-XSRF-TOKEN" class="headerlink" title="X-XSRF-TOKEN"></a>X-XSRF-TOKEN</h3><p>laravel自动存储了CSRF token 到 cookie中并被命名为 <code>XSRF-TOKEN</code>, 你可以在每次请求的请求头里引入<code>X-XSRF-TOKEN</code>并将其值设置为 <code>XSRF-TOKEN</code>的cookie值来通过csrf验证。有一些javascript框架里已经自动做了这些，像 angularjs. 如果你没有引入这些前端框架，你可能需要自己手动去做了:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">fetch(<span class="string">'/user/password'</span>, &#123;</div><div class="line">  method: <span class="string">'POST'</span>,</div><div class="line">  headers: &#123;</div><div class="line">    <span class="string">'X-XSRF-TOKEN'</span>: </div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h2 id="绑定模型的路由"><a href="#绑定模型的路由" class="headerlink" title="绑定模型的路由"></a>绑定模型的路由</h2><p>绑定模型的路由提供了一种便利的方式去注入模型实例到路由中，比如，你可以通过传递id，来注入匹配id的用户的整个模型到路由中。</p>
<h3 id="隐式绑定"><a href="#隐式绑定" class="headerlink" title="隐式绑定"></a>隐式绑定</h3><p>laravel会自动的解析定义在路由或者控制器中的<code>Eloquent</code>模型, 根据变量名与参数名匹配的，比如<code>api/users/{user}</code> 匹配 <code>$user</code>变量：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Route::get(<span class="string">'api/users/&#123;user&#125;'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(App\User $user)</span> </span>&#123;</div><div class="line">  <span class="keyword">return</span> $user-&gt;email; </div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>在上面的例子中，$user是根据url中<code>{user}</code>片段的值进行实例生成的.这种绑定模型到路由一般都是默认根据id进行匹配注入实例。比如说 <code>users/1</code>，匹配到的就是id = 1的用户实例。如果没有匹配的实例，则会返回404。</p>
<h3 id="自定义索引绑定模型到路由"><a href="#自定义索引绑定模型到路由" class="headerlink" title="自定义索引绑定模型到路由"></a>自定义索引绑定模型到路由</h3><p>如果你不想用id去绑定模型到路由，laravel提供了一种可自定义的方式，你只需要在相应的模型里重写<code>getRouteKeyName</code>方法就行了，比如我们用名字来代替id注入模型到路由:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getRouteKeyName</span><span class="params">()</span> </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="string">'name'</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样在路由url中就是类似这种形式了 <code>users/wang</code></p>
<h3 id="显式绑定"><a href="#显式绑定" class="headerlink" title="显式绑定"></a>显式绑定</h3><p>如果需要注册一种显式的模型绑定到路由，你需要使路由的<code>model</code>方法去指定类与参数的映射。并且你应该在路由服务的<code>boot</code>方法中进行绑定注册操作：</p>
<h3 id="绑定到模型"><a href="#绑定到模型" class="headerlink" title="绑定到模型"></a>绑定到模型</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span><span class="params">(Router $router)</span> </span>&#123;</div><div class="line">  <span class="keyword">parent</span>::boot($router);</div><div class="line"></div><div class="line">  $router-&gt;model(<span class="string">'user'</span>, <span class="string">'App\User'</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样，在<code>routes.php</code>文件中注册的路由如果使用了<code>{user}</code>的命名路由就可以自动绑定到模型:<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$router-&gt;get(<span class="string">'profile/&#123;user&#125;'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(App\User $user)</span> </span>&#123;</div><div class="line"> <span class="comment">// </span></div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<h3 id="自定义绑定解析逻辑"><a href="#自定义绑定解析逻辑" class="headerlink" title="自定义绑定解析逻辑"></a>自定义绑定解析逻辑</h3><p>如果你想自定义解析返回实例的逻辑，那么你需要使用<code>Route::bind</code>方法，该方法第一个参数为绑定url的参数名，第二个参数为<code>Closure</code>, 闭包中会接收一个参数，这个参数是url中对应参数片段的值，你应该在闭包中返回解析后的实例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$router-&gt;bind(<span class="string">'user'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($value)</span> </span>&#123;</div><div class="line"> <span class="keyword">return</span> App\User::where(<span class="string">'name'</span>, $value)-&gt;first(); </div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="自定义找不到实例时的行为"><a href="#自定义找不到实例时的行为" class="headerlink" title="自定义找不到实例时的行为"></a>自定义找不到实例时的行为</h3><p>如果你想要自定义无法匹配实例时的行为，你可以向<code>model</code>方法传递第三个参数，该参数是一个闭包函数，它将在无法匹配到实例时执行：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$router-&gt;model(<span class="string">'user'</span>, <span class="string">'App\User'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> NotFoundHttpException;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h2 id="表单提交方式模拟"><a href="#表单提交方式模拟" class="headerlink" title="表单提交方式模拟"></a>表单提交方式模拟</h2><p>由于HTML的表单不能支持像<code>PUT</code>,<code>PATCH</code>或者<code>DELETE</code>的请求方式，所以，当需要访问类似的路由时，你需要在表单中增加一个隐藏的字段<code>_method</code>，用来表明你真实的表单请求方式:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">“/foo/bar</span>" <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"_method"</span> <span class="attr">value</span>=<span class="string">"PUT"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"_token"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; csrf_token() &#125;&#125;"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure>
<p>laravel也提供了便捷生成隐藏字段<code>_method</code>的方法，你可以使用<code>method_field</code>帮助方法：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> method_field(); <span class="meta">?&gt;</span></div></pre></td></tr></table></figure></p>
<p>使用blade模板引擎可以直接这么用：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;&#123; method_field(<span class="string">'PUT'</span>) &#125;&#125;</div></pre></td></tr></table></figure></p>
<h2 id="访问当前路由"><a href="#访问当前路由" class="headerlink" title="访问当前路由"></a>访问当前路由</h2><p><code>Route::current()</code> 会返回一个<code>Illuminate\Routing\Route</code>的实例，它允许你在当前路由内处理相关请求：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$route = Route::current();</div><div class="line"></div><div class="line">$name = $route-&gt;getName();</div><div class="line"></div><div class="line">$actionName = $route-&gt;getActionName();</div></pre></td></tr></table></figure>
<p>当然你也可以通过<code>Route</code>facade去访问路由的name或action:<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$name = Route::currentRouteName();</div><div class="line"></div><div class="line">$action = Route::currentRouteAction();</div></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/18/laravel-from-scratch-configuration/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dearmadman">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Team.dearmadman.com">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/18/laravel-from-scratch-configuration/" itemprop="url">laravel 基础教程 —— 配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-04-18T16:19:40+08:00">
                2016-04-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="laravel基础教程-——-配置"><a href="#laravel基础教程-——-配置" class="headerlink" title="laravel基础教程 —— 配置"></a>laravel基础教程 —— 配置</h1><p>所有配置文件都被保存在<code>config</code>目录下，并且每个配置文件里的配置项都有文档标注。</p>
<h2 id="访问配置值"><a href="#访问配置值" class="headerlink" title="访问配置值"></a>访问配置值</h2><p><code>config</code>全局帮助方法被提供在<code>vendor/laravel/framework/src/Illuminate/Foundation/helpers.php</code> 文件中，该函数允许使用 <code>.</code> 语法来获取文件内的配置项值。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$value = config(<span class="string">'app.timezone'</span>);</div></pre></td></tr></table></figure>
<p>你也可以在config函数传递第二个参数作为默认值，当找不到该配置项时返回默认值.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$value = config(<span class="string">'app.timezone'</span>, <span class="string">'Asia/Shanghai'</span>);</div></pre></td></tr></table></figure>
<p>设置配置项的值：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">config([<span class="string">'app.timezone'</span> =&gt; <span class="string">'Asia/Shanghai'</span>]);</div></pre></td></tr></table></figure>
<h3 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h3><p>我们经常希望开发环境和生产环境具有不同的配置。比如说你在本地开发环境使用不同的缓存驱动，而laravel基于环境的配置使之非常容易。</p>
<p>laravel使用了<a href="https://github.com/vlucas/phpdotenv" target="_blank" rel="external">DotEnv</a>类库来构建基于环境的配置，默认的基于环境的配置信息在根目录下的<code>.env</code>文件中，如果你是通过<code>composer</code>的方式安装的laravel，那么它会自动的将<code>.env.example</code>文件复制并重命名为<code>.env</code>, 如果不是你则需要手动做了。如果你每增加一个基于环境的配置项，你最好在<code>.env.example</code>中增加相同的配置项，这样在多人协作中别人可以根据<code>.env.example</code>理解你的配置信息.</p>
<p>每当程序接收到request请求时，应用程序会自动装载<code>.env</code>文件，并将配置信息封装在全局变量<code>$_ENV</code>中，当然你也可以通过全局辅助函数<code>env()</code>来进行获取环境配置项信息并将其设置在你的其它配置文件中，事实上，laravel已经在部分配置文件中使用这种这种方式进行配置。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="string">'debug'</span> =&gt; env(<span class="string">'APP_DEBUG'</span>, <span class="keyword">false</span>),</div></pre></td></tr></table></figure>
<p><code>env</code>函数中的第二个参数为配置项的默认值，当环境配置文件<code>.env</code>中没有该配置项时会自动使用默认值。</p>
<p>另外你的<code>.env</code>配置环境不应该提交到版本控制器中，因为其它服务器环境或者开发者环境可能需要引入不同的环境配置。比如生产环境不应该开启debug, 不同的开发者的本地数据库配置信息可能不同。</p>
<p>如果你是在一个团队中做开发，你应该在<code>.env.example</code>文件中引入你增加的环境配置信息，并提交给其它开发者知道，这样他们就能够理解使用你开发的部分应该引入哪些配置信息。</p>
<h3 id="确定当前环境"><a href="#确定当前环境" class="headerlink" title="确定当前环境"></a>确定当前环境</h3><p>当前环境是定义在<code>.env</code>文件中的<code>APP_ENV</code>变量里的，你可以通过<code>App</code> <strong>facade</strong> 的 <code>environment</code> 函数来获取：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$environment = App::environment();</div></pre></td></tr></table></figure>
<p>当然你也可以通过 全局方法 <code>env</code> 或 <code>app</code> 来获取：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">$</span><span class="bash">environment = env(<span class="string">'APP_ENV'</span>);</span></div><div class="line"><span class="meta">#</span><span class="bash"> or</span></div><div class="line"><span class="meta">$</span><span class="bash">environment = app()-&gt;environment();</span></div></pre></td></tr></table></figure>
<p>有时候我们需要特别识别一下当前环境是哪种环境，并根据不同的环境执行不同的业务逻辑，这时候就需要通过<code>environment</code>函数来进行判断匹配了，当然你可以在其中传递一个或多个环境参数，只要匹配到其中任何一个都会返回true:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (App::environment(<span class="string">'local'</span>)) &#123;</div><div class="line">  /<span class="regexp">/ if env('APP_ENV') === 'local'</span></div><div class="line"><span class="regexp">&#125;</span></div><div class="line"><span class="regexp"></span></div><div class="line"><span class="regexp">if (App::environment('local', 'staging')) &#123;</span></div><div class="line"><span class="regexp">  /</span><span class="regexp">/ env('APP_ENV') === 'local' || env('APP_ENV') === 'staging'</span></div><div class="line"><span class="regexp">&#125;</span></div></pre></td></tr></table></figure>
<h3 id="缓存配置信息"><a href="#缓存配置信息" class="headerlink" title="缓存配置信息"></a>缓存配置信息</h3><p>在<code>config</code>目录下有很多配置文件，配置文件中有不同的配置信息，为了启动程序更为迅速，我们可以在开发环境中将这些配置信息集中到一个配置文件中，这样，程序在被访问时，不会每次都要加载N个文件了，我们可以通过<code>artisan</code>的 <code>config:cache</code>命令 来做这件事情。所有配置文件被整合在一个文件里并被程序自动加载。</p>
<p>当然，在开发环境并不建议这么做，因为开发环境我们可能会频繁的更改配置信息，这样为了使配置信息及时生效我们不得不频繁的运行 <code>php artisan config:cache</code>命令， 偶尔我们会忘记执行命令。生产环境缓存配置文件应该是常态,并且应该在版本发布时执行缓存配置文件命令重新生成缓存配置信息。你应该将其做为自动发布的一部分。</p>
<h3 id="维护模式"><a href="#维护模式" class="headerlink" title="维护模式"></a>维护模式</h3><p>laravel提供了维护模式，维护模式在开启时，所有的访问请求都会被返回某个视图，这个视图是可以自定义的。如果维护模式开启，则每个请求都会返回 503 状态码。<br>开启维护模式的方法:</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">php artisan down</span></div></pre></td></tr></table></figure>
<p>关闭维护模式的方法：<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">php artisan up</span></div></pre></td></tr></table></figure></p>
<h4 id="维护模式响应模板"><a href="#维护模式响应模板" class="headerlink" title="维护模式响应模板"></a>维护模式响应模板</h4><p>维护模式响应的视图模板存放在<code>resources/views/errors/503.blade.php</code>, 你可以自由的修改。</p>
<h4 id="维护模式-amp-队列"><a href="#维护模式-amp-队列" class="headerlink" title="维护模式 &amp; 队列"></a>维护模式 &amp; 队列</h4><p>在维护模式开启时，队列工作将会暂停执行，当维护模式关闭时，队列将继续进行处理工作。</p>
<h4 id="备选方案到维护模式"><a href="#备选方案到维护模式" class="headerlink" title="备选方案到维护模式"></a>备选方案到维护模式</h4><p>由于开启维护模式需要关闭应用程序一段时间，所以你也许可以考虑像<a href="https://envoyer.io/" target="_blank" rel="external">Envoyer</a>这种不需要关闭应用程序的持续集成服务。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/18/laravel-from-scratch-initial-setup/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dearmadman">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Team.dearmadman.com">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/18/laravel-from-scratch-initial-setup/" itemprop="url">laravel 基础教程 —— 安装</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-04-18T14:51:26+08:00">
                2016-04-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="laravel基础教程-——-安装"><a href="#laravel基础教程-——-安装" class="headerlink" title="laravel基础教程  —— 安装"></a>laravel基础教程  —— 安装</h1><h2 id="环境需求"><a href="#环境需求" class="headerlink" title="环境需求"></a>环境需求</h2><ul>
<li>PHP &gt;= 5.5.9</li>
<li>OpenSSL 扩展</li>
<li>PDO 扩展</li>
<li>Mbstring 扩展</li>
<li>Tokenizer 扩展</li>
</ul>
<h2 id="安装方式"><a href="#安装方式" class="headerlink" title="安装方式"></a>安装方式</h2><h3 id="通过Homestead安装"><a href="#通过Homestead安装" class="headerlink" title="通过Homestead安装"></a>通过Homestead安装</h3><p><strong>初学者不建议此方式安装!  会明显增加上手难度</strong>  安装方式参考文档： <a href="https://laravel.com/docs/5.2/homestead" target="_blank" rel="external">Laravel Homestead</a></p>
<p><code>ps: 如果是win用户，我劝你还是用此方式安装吧</code></p>
<h3 id="通过Composer安装"><a href="#通过Composer安装" class="headerlink" title="通过Composer安装"></a>通过Composer安装</h3><blockquote>
<p>Composer是PHP的软件包管理系统, 是 PHP 用来管理依赖（dependency）关系的工具。你可以在自己的项目中声明所依赖的外部工具库（libraries），Composer 会帮你安装这些依赖的库文件。</p>
</blockquote>
<h4 id="安装Composer"><a href="#安装Composer" class="headerlink" title="安装Composer"></a>安装Composer</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl https:<span class="comment">//getcomposer.org/download/1.0.0/composer.phar -O &amp;&amp; mv composer.phar /usr/local/bin/composer</span></div></pre></td></tr></table></figure>
<h4 id="安装laravel"><a href="#安装laravel" class="headerlink" title="安装laravel"></a>安装laravel</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">composer <span class="keyword">global</span> <span class="keyword">require</span> <span class="string">"laravel/installer"</span></div></pre></td></tr></table></figure>
<h4 id="新建项目"><a href="#新建项目" class="headerlink" title="新建项目"></a>新建项目</h4><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">laravel <span class="keyword">new</span> my-<span class="keyword">project</span></div></pre></td></tr></table></figure>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>所有配置文件都在<code>my-project/config</code>目录下</p>
<h3 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h3><p><code>storage</code>和<code>bootstrap/cache</code>目录下需要有写权限，否则laravel没办法运行.</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chmod <span class="number">755</span> <span class="params">-R</span> storage bootstrap/<span class="keyword">cache</span></div></pre></td></tr></table></figure>
<h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd my-project &amp;&amp; php artisan serve </div><div class="line"><span class="comment">// laravel development server started on http://localhost:8000/</span></div></pre></td></tr></table></figure>
<h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><p>其实安装本身并不难，你有可能会卡壳在下载环节，这初学时这确实浪费了不少时间。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/17/refactoring-to-pattern/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dearmadman">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Team.dearmadman.com">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/17/refactoring-to-pattern/" itemprop="url">设计模式之谈：从重构到模式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-04-17T07:19:58+08:00">
                2016-04-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="从重构到模式"><a href="#从重构到模式" class="headerlink" title="从重构到模式"></a>从重构到模式</h1><p>  当你意识到你需要理解并学会重构的时候，就是你即将进阶的时候。<br>  专业的程序员都是从这里开始正式的职业之旅的。</p>
<h2 id="重构"><a href="#重构" class="headerlink" title="重构"></a>重构</h2><blockquote>
<p>代码重构(code refactoring) 指对软件代码做任何改动以增加可读性或者简化结构而不影响输出结果。</p>
<p>在软件工程学里，重构代码一词通常是指在不改变代码的外部行为情况下而修改源代码，有时非正式的称为“清理干净”。在极限编程或者敏捷方法学中，重构常常是软件开发循环中的一部分：开发者轮流增加新的测试和功能，并重构代码来增进内部的清晰性和一致性。自动化的单元测试保证了重构不至于让代码停止工作。</p>
<p>重构既不修正错误，又不增加新的功能性。反而它是用来提高代码的可读性或者改变代码的内部结构和设计，并且移除死代码，使其将来更容易被维护。重构代码可以是结构层面抑或语义层面，不同的重构手段施行时，可能是结构的调整或语义的转换，但前提是不影响代码在转换前后的行为。特别是，在现有的程序结构下，给一个程序增加新的行为可能非常的困难，因此开发人员可能先重构这部分代码，使加入新行为变得容易。</p>
</blockquote>
<p>重构是为了更好的维护与扩展，它能使你快速的了解原有代码的设计，不至于你一个月后再回头看源代码时有种完全看不懂的感觉。</p>
<p>频繁的重构之后，总会有一些通用的模式在里面，将这些通用的模式总结起来，构成了设计模式。</p>
<h2 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h2><blockquote>
<p>在软件工程中，设计模式是对软件设计中普遍存在（反复出现）的各种问题，所提出的解决方案。</p>
<p>设计模式并不直接用来完成代码的编写，而是描述在各种不同情况下，要怎么解决问题的一种方案。面向对象设计模式通常以类或对象来描述其中的关系和相互作用，但不涉及用来完成应用程序的特定类或对象。设计模式能使不稳定依赖于相对稳定、具体依赖于相对抽象，避免会引起麻烦的紧耦合，以增强软件设计面对适应变化的能力。</p>
</blockquote>
<p>说到设计模式，我们不得不说到模式。</p>
<h3 id="模式"><a href="#模式" class="headerlink" title="模式"></a>模式</h3><blockquote>
<p>模式（pattern), 在物体或事件上，产生的一种规律变化与自我重复的样式与过程。在模式之中，某些固定的元素不断以可预测的方式周期性重现。最基本而常见的模式，称为密铺，具备重复性与周期性两大特征。找寻出固定模式是人类基本的认知功能之一。</p>
</blockquote>
<p>模式的存在，方便我们复用问题的解决方案。<br>如果我们需要去劈柴，我们很可能就会想到斧头。因为斧头是劈柴的常用解决方案。</p>
<h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><p>  当我们学习设计模式，发现并不能理解，或者觉得并不能很好的运用的时候，或许你需要好好学习一下重构，如果没有理解重构，而直接跳过它学习设计模式，这个过程将是事倍功半的。</p>
<p>推荐书籍：</p>
<ul>
<li>《重构：改善既有代码的设计》</li>
<li>《设计模式之禅》</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/15/for-php-beginner/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dearmadman">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Team.dearmadman.com">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/15/for-php-beginner/" itemprop="url">写给想学 PHP 的朋友们</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-04-15T10:21:48+08:00">
                2016-04-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="写给想学php的朋友们"><a href="#写给想学php的朋友们" class="headerlink" title="写给想学php的朋友们"></a>写给想学php的朋友们</h1><p>  php是一门非常简单的语言，是一门很容易入门的语言，对于编程初学者来说是非常适合做为编程入门选择的一门语言，它，并不难。</p>
<h2 id="我的经历"><a href="#我的经历" class="headerlink" title="我的经历"></a>我的经历</h2><p>  我的php是自学的，并没有去培训机构去接受培训，一是感觉性价比并不是很高，二是当时的我具备信息检索的能力，又非常巧合的检索到燕十八老师的课程，然后跟着课程苦学了一个半月，做了一个简易的商城，拿下了第一份Php的工作。</p>
<p>  说这些只是想告诉那些想学php的朋友，学习php其实没有想象中的那么艰难，难得是你想要学习的态度和毅力。对未知的恐惧往往阻碍了人前进的道路。</p>
<h2 id="我所推荐的学习路线"><a href="#我所推荐的学习路线" class="headerlink" title="我所推荐的学习路线"></a>我所推荐的学习路线</h2><p>  这里我只简单的描述一下成长路线的大概，我并不太推荐你入门的时候就了解的太多太多，这样会干扰了你继续学习的动力。你的精力是有限的，如果你想学好它，那么你就应该将你的精力集中在它本身之上。</p>
<p>  学习的道路上会出现太多太多的干扰，特别是现在需要多种编程技能在身的我们，有时候，你需要适当的做做减法，思考一下自己当前的状态，我觉得我们应该成为专业的php工程师之后再去迷失在其它技能之上。</p>
<h3 id="初级"><a href="#初级" class="headerlink" title="初级"></a>初级</h3><p>  书，是系统知识传递最好的路径。想要学一门技能首先要打好基础，这是必定要走过的路，忽略了它，你就会走弯路，最终还是要绕回来。基础扎实了，可以节省我们调试Bug的时间。不会遇到一个小小的问题就要浪费一个上午的时间去寻求帮助。</p>
<p>  我推荐《php和mysql web开发》,这本书作为入门完全足够了，花几个月的时间根据内容边学边练，反复读个三遍，肯定会收获良多。</p>
<p>  你也可以借助网络上丰富的资源去进行刻意的练习，比如说<code>慕课网</code>，是非常适合初学者学习的一个社区. </p>
<p>  项目驱动应该是学习最快的路径， 因为学习技能就是为了解决问题的， 而在解决问题的时候往往我们的理解会变得更为深刻。</p>
<p>  善于总结，对你的学习肯定是有所帮助的。</p>
<h3 id="中级"><a href="#中级" class="headerlink" title="中级"></a>中级</h3><p>  这个时候你应该具备了使用php解决问题的能力。如果你做过几个项目，你可能会对php工程师有一个基本的理解。如果你想要在这个行业有一个很好的发展，那么你就需要正视你自己的职业。</p>
<p>  你要正视自己的职业，你就需要考虑你为什么比别人专业，你就应该提高自身技能的专业性。</p>
<p>  你可以学习一下一些开源的框架来提高自身的专业性，这里我推荐<code>laravel</code>, 虽然可能对于你来说它比较困难，但他确实是带你领略编程世界的敲门砖。门后的世界要么使你疯狂，要么使你迷失在疯狂的路上 ：）<br>  这时候你就要学习非常多的知识了，如果你具有修炼葵花宝典的勇气，那么你肯定能够得到它们 ：）</p>
<h3 id="高级"><a href="#高级" class="headerlink" title="高级"></a>高级</h3><p>  作为一个高级工程师你就要具备非常多的技能了，你应该具备了学习的态度，太多的技能在身使你并不惧怕去学习额外的技能，有的时候你可能想体验舒适区之外的世界，那么就勇敢的去做吧。<br>  高级工程师具备了协作能力，自我学习的能力，自我提升的能力，及善于逃离舒适区的能力。 ：）</p>
<h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><p>  本身是想写一些详细的学习路线的，详细的中级到高级的指南的，想想还是算了，因为我觉得向初学者去描述这些，他们不但不会理解，还会充满疑惑 ：）<br>  因为他们还没有经历过 ：）<br>  学习充满了趣味，共勉之 ：）</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/13/dependency-injection-and-inversion-of-control/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dearmadman">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Team.dearmadman.com">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/13/dependency-injection-and-inversion-of-control/" itemprop="url">理解依赖注入与控制反转</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-04-13T09:37:29+08:00">
                2016-04-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="依赖注入与控制反转"><a href="#依赖注入与控制反转" class="headerlink" title="依赖注入与控制反转"></a>依赖注入与控制反转</h1><p><strong>依赖注入</strong> 当我第一次接触这个词的时候，我是有些丈二和尚摸不着头脑的，至今我也是感到比较困惑的，所以今天我们来探索一下Laravel中的<code>依赖注入(dependency injection)</code>, 来好好的理解它。<br><strong>控制反转</strong> 第一印象是好深奥的名词。。。看上去好像是说反向控制？不懂？那就理顺之！</p>
<h2 id="起点"><a href="#起点" class="headerlink" title="起点"></a>起点</h2><h3 id="什么是依赖"><a href="#什么是依赖" class="headerlink" title="什么是依赖"></a>什么是依赖</h3><p>  没有你我就活不下去，那么，你就是我的依赖。<br>说白了就是：</p>
<blockquote>
<p>不是我自身的，却是我需要的，都是我所依赖的。一切需要外部提供的，都是需要进行依赖注入的。</p>
</blockquote>
<p>我们用代码来描述一下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boy</span> </span>&#123;</div><div class="line">  <span class="keyword">protected</span> $girl;</div><div class="line">  </div><div class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(Girl $girl)</span> </span>&#123;</div><div class="line">    <span class="keyword">$this</span>-&gt;girl = $girl;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Girl</span> </span>&#123;</div><div class="line">  ...</div><div class="line">&#125;</div><div class="line"></div><div class="line">$boy = <span class="keyword">new</span> Boy();  <span class="comment">// Error; Boy must have girlfriend!</span></div><div class="line"></div><div class="line"><span class="comment">// so 必须要给他一个女朋友才行 </span></div><div class="line">$girl = <span class="keyword">new</span> Girl();</div><div class="line"></div><div class="line">$boy = <span class="keyword">new</span> Boy($girl); <span class="comment">// Right! So Happy!</span></div></pre></td></tr></table></figure>
<p>从上述代码我们可以看到<code>Boy</code>强依赖<code>Girl</code>必须在构造时注入<code>Girl</code>的实例才行。</p>
<p>那么为什么要有<code>依赖注入</code>这个概念，<code>依赖注入</code>到底解决了什么问题？</p>
<p>我们将上述代码修正一下我们初学时都写过的代码:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boy</span> </span>&#123;</div><div class="line">  <span class="keyword">protected</span> $girl;</div><div class="line"></div><div class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">$this</span>-&gt;girl = <span class="keyword">new</span> Girl();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这种方式与前面的方式有什么不同呢？</p>
<p>我们会发现<code>Boy</code>的女朋友被我们硬编码到<code>Boy</code>的身体里去了。。。 每次<code>Boy</code>重生自己想换个类型的女朋友都要把自己扒光才行。。。 (⊙o⊙)…</p>
<p>某天<code>Boy</code>特别喜欢一个<code>LoliGirl</code> ,非常想让她做自己的女朋友。。。怎么办？<br>重生自己。。。扒开自己。。。把<code>Girl</code>扔了。。。把 <code>LoliGirl</code>塞进去。。。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoliGirl</span> </span>&#123;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boy</span> </span>&#123;</div><div class="line">  <span class="keyword">protected</span> $girl; </div><div class="line">  </div><div class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</div><div class="line">      <span class="comment">//  $this-&gt;girl = new Girl();  // sorry...</span></div><div class="line">      <span class="keyword">$this</span>-&gt;girl = <span class="keyword">new</span> LoliGirl();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>某天 <code>Boy</code>迷恋上了御姐…. (⊙o⊙)… <code>Boy</code> 好烦。。。</p>
<p>是不是感觉不太好？每次遇到真心相待的人却要这么的折磨自己。。。</p>
<p><code>Boy</code>说，我要变的强大一点。我不想被改来改去的！</p>
<p>好吧，我们让<code>Boy</code>强大一点：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Girl</span> </span>&#123;</div><div class="line">  <span class="comment">// Boy need knows that I have some abilities.</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoliGril</span> <span class="title">implement</span> <span class="title">Girl</span> </span>&#123;</div><div class="line">  <span class="comment">// I will implement Girl's abilities.</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vixen</span> <span class="title">implement</span> <span class="title">Girl</span> </span>&#123;</div><div class="line">  <span class="comment">// Vixen definitely is a girl, do not doubt it.</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boy</span> </span>&#123;</div><div class="line">  <span class="keyword">protected</span> $girl;</div><div class="line">  </div><div class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(Girl $girl)</span> </span>&#123;</div><div class="line">    <span class="keyword">$this</span>-&gt;girl = $girl;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$loliGirl = <span class="keyword">new</span> LoliGirl();</div><div class="line">$vixen = <span class="keyword">new</span> Vixen();</div><div class="line"></div><div class="line">$boy = <span class="keyword">new</span> Boy($loliGirl);</div><div class="line">$boy = <span class="keyword">new</span> Boy($vixen);</div></pre></td></tr></table></figure>
<p><code>Boy</code>很高兴，终于可以不用扒开自己就可以体验不同的人生了。。。So Happy!</p>
<h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><blockquote>
<p>因为大多数应用程序都是由两个或者更多的类通过彼此合作来实现业务逻辑，这使得每个对象都需要获取与其合作的对象（也就是它所依赖的对象）的引用。如果这个获取过程要靠自身实现，那么将导致代码高度耦合并且难以维护和调试。</p>
</blockquote>
<p>所以才有了依赖注入的概念，依赖注入解决了以下问题：</p>
<ul>
<li>依赖之间的解耦</li>
<li>单元测试，方便Mock</li>
</ul>
<p>=。= 前面的依赖注入居然需要我们手动的去注入依赖，做为程序员的我们怎么可以容忍这种低效的注入方式，好吧，我们先来了解一下<strong>IOC</strong>的概念.</p>
<h3 id="控制反转-（Inversion-Of-Control-IOC）"><a href="#控制反转-（Inversion-Of-Control-IOC）" class="headerlink" title="控制反转 （Inversion Of Control, IOC）"></a>控制反转 （Inversion Of Control, IOC）</h3><blockquote>
<p><strong>控制反转</strong> 是面向对象编程中的一种设计原则，可以用来减低计算机代码之间的耦合度。其中最常见的方式叫做<strong>依赖注入</strong>（Dependency Injection, DI）, 还有一种叫”依赖查找”（Dependency Lookup）。通过控制反转，对象在被创建的时候，由一个调控系统内所有对象的外界实体，将其所依赖的对象的引用传递给它。也可以说，依赖被注入到对象中。</p>
</blockquote>
<p>也就是说，我们需要一个调控系统，这个调控系统中我们存放一些对象的实体，或者对象的描述，在对象创建的时候将对象所依赖的对象的引用传递过去。<br>在Laravel中<code>Service Container</code>就是这个高效的调控系统，它是laravel的核心。<br>下面我们看一下laravel是如何实现自动依赖注入的。</p>
<h2 id="laravel中的依赖注入"><a href="#laravel中的依赖注入" class="headerlink" title="laravel中的依赖注入"></a>laravel中的依赖注入</h2><p>现在我们看文档给的例子应该就不难理解了:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"></div><div class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Jobs</span>;</div><div class="line"></div><div class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">User</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Mail</span>\<span class="title">Mailer</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Bus</span>\<span class="title">SelfHandling</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PurchasePodcast</span> <span class="keyword">implements</span> <span class="title">SelfHandling</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * The mailer implementation.</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">protected</span> $mailer;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * Create a new instance.</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span>  Mailer  $mailer</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(Mailer $mailer)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;mailer = $mailer;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * Purchase a podcast.</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="comment">//</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>In this example, the <code>PurchasePodcast</code> job needs to send e-mails when a podcast is purchased. So, we will <strong>inject</strong> a service that is able to send e-mails. Since the service is injected, we are able to easily swap it out with another implementation. We are also able to easily “mock”, or create a dummy implementation of the mailer when testing our application.</p>
</blockquote>
<p>说到laravel中的依赖注入，我们不得不了解laravel的<code>Service Container</code></p>
<h3 id="服务容器-Service-Container"><a href="#服务容器-Service-Container" class="headerlink" title="服务容器 (Service Container)"></a>服务容器 (Service Container)</h3><blockquote>
<p>The Laravel service container is a powerful tool for managing class dependencies and performing dependency injection. Dependency injection is a fancy phrase that essentially means this: class dependencies are “injected” into the class via the constructor or, in some cases, “setter” methods.</p>
</blockquote>
<p>从介绍不难看出服务容器就是控制反转的容器，它就是前文说到的调度系统。实现依赖注入的方式可以是在构造函数中或者<code>setter</code>方法中。</p>
<p>如果我们仔细研究了<code>Service Container</code>我们就会发现laravel的服务容器中只存储了对象的描述，而并不需要知道如何具体的去构造一个对象，因为它会根据php的<code>反射服务</code>去自动解析具体化一个对象。</p>
<h4 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h4><blockquote>
<p>在计算机科学中，<strong>反射</strong>是指计算机在运行时（Run time）可以访问、检测和修改它本身状态或行为的一种能力。用来比喻说，那种程序能够“观察”并且修改自己的行为。</p>
<p>支持反射的语言提供了一些在低级语言中难以实现的运行时特性。这些特性包括</p>
<ul>
<li>作为一个第一类对象发现并修改源代码的结构（如代码块、类、方法、协议等）。</li>
<li>将跟class或function匹配的转换成class或function的调用或引用。</li>
<li>在运行时像对待源代码语句一样计算字符串。</li>
<li>创建一个新的语言字节码解释器来给编程结构一个新的意义或用途。</li>
</ul>
</blockquote>
<p>PHP实现的反射可以在官网文档中进行查看： <strong><a href="http://php.net/manual/zh/intro.reflection.php" target="_blank" rel="external">反射API</a></strong></p>
<h5 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$reflector = <span class="keyword">new</span> ReflectionClass(<span class="string">'App\User'</span>);</div><div class="line"></div><div class="line"><span class="keyword">if</span> ($reflector-&gt;isInstantiable()) &#123;</div><div class="line">  $user = $refector-&gt;newInstance(); <span class="comment">//in other case you can send any arguments</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>laravel的服务容器的<code>build</code>方法中需要通过<code>反射服务</code>来解析依赖关系，比如说<code>construct</code>函数中需要传递的依赖参数有哪些? 它就需要用到如下方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">$constructor = $reflector-&gt;getConstructor();</div><div class="line"></div><div class="line"><span class="comment">// If there are no constructors, that means there are no dependencies then</span></div><div class="line"><span class="comment">// we can just resolve the instances of the objects right away, without</span></div><div class="line"><span class="comment">// resolving any other types or dependencies out of these containers.</span></div><div class="line"><span class="keyword">if</span> (is_null($constructor)) &#123;</div><div class="line">    array_pop(<span class="keyword">$this</span>-&gt;buildStack);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> $concrete;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$dependencies = $constructor-&gt;getParameters();</div></pre></td></tr></table></figure>
<p>现在我们应该对laravel如何实现依赖的自动注入有点想法了吧？来整理一下疑问：</p>
<ul>
<li>如何实现依赖的自动注入？ （控制反转，利用反射）</li>
<li>依赖注入需要哪些东东？ （整理依赖关系[ construct | setter ]，还要解析依赖传递引用）</li>
<li>怎么解析依赖？</li>
</ul>
<p>你可能会问为什么要问怎么解析依赖？解析依赖肯定是要用到反射的啦，反射，你知道类名不就可以直接解析了吗？</p>
<p>其实。。。不是这样的。。。(<em>@ο@</em>) </p>
<p>很多时候我们为了提高代码的扩展性和维护性，在编写类时依赖的是接口或抽象类，而并不是一个具体的实现类。明白了吗？依赖解析的时候如果只解析到接口或抽象类，然后利用反射，那么这个依赖肯定是错误的。</p>
<p>那么我们就需要在调度系统中注入相关依赖的映射关系，然后在需要的时候正确的解析关系。<br>比如说， 喂， 我需要一个 A, 你别给我 B 啊。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$container-&gt;bind(<span class="string">'a'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> B();  <span class="comment">// just this for you</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line">$a = $container-&gt;make(<span class="string">'a'</span>);</div></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>依赖注入是控制反转的一种实现，实现代码解耦，便于单元测试。因为它并不需要了解自身所依赖的类，而只需要知道所依赖的类实现了自身所需要的方法就可以了。<code>你需要我，你却不认识我/(ㄒoㄒ)/~~</code></li>
<li>控制反转提供一种调控系统，实现依赖解析的自动注入，一般配合容器提供依赖对象实例的引用。</li>
</ul>
<p>推荐阅读: </p>
<ul>
<li><a href="http://huoding.com/2015/11/11/482" target="_blank" rel="external">Dependency Injection 和 Service Locator</a></li>
<li><a href="https://www.insp.top/article/learn-laravel-container" target="_blank" rel="external">laravel 学习笔记 —— 神奇的服务容器</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/09/learn-boilerplate-source/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dearmadman">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Team.dearmadman.com">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/09/learn-boilerplate-source/" itemprop="url">laravel-boilerplate 源码学习 (一)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-04-09T09:15:58+08:00">
                2016-04-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="laravel-boilerplate"><a href="#laravel-boilerplate" class="headerlink" title="laravel-boilerplate"></a>laravel-boilerplate</h1><p>读laravel-boilerplate源码，分析各模块编码方式，分析代码整理方式，分析目录结构，以提高自我编码水平，提高代码整理能力。提高模块化架构能力，提高面向对象分析能力。</p>
<h2 id="目录结构分析"><a href="#目录结构分析" class="headerlink" title="目录结构分析"></a>目录结构分析</h2><h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><ul>
<li>路由分组</li>
<li>结构化目录</li>
<li>独立路由以require的形式注入</li>
<li>保持组命名空间与目录一致</li>
<li>命名路由</li>
</ul>
<h4 id="路由分组"><a href="#路由分组" class="headerlink" title="路由分组"></a>路由分组</h4><p>所有路由入口在 <code>app\Http\routes.php</code>文件中，在该文件中定义分组路由:</p>
<ul>
<li>web端路由组 （包含 前端路由组 及 语言选择路由组）</li>
<li>后端路由组</li>
</ul>
<h4 id="结构化目录"><a href="#结构化目录" class="headerlink" title="结构化目录"></a>结构化目录</h4><p>建立<code>app\Http\Routes\</code>文件目录，用于存放各模块组路由并建立相应的文件目录：</p>
<ul>
<li>Backend</li>
<li>Frontend</li>
<li>Language</li>
</ul>
<p>在模块组目录下细化模块路由</p>
<h4 id="独立路由以require的形式注入"><a href="#独立路由以require的形式注入" class="headerlink" title="独立路由以require的形式注入"></a>独立路由以require的形式注入</h4><p>相应的模块组目录下的细化模块路由文件 在<code>app\Http\routes.php</code> 文件中相应路由组中以require的形式注入:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Backend Routes</span></div><div class="line"><span class="comment"> * Namespaces indicate folder structure</span></div><div class="line"><span class="comment"> * Admin middleware groups web, auth, and routeNeedsPermission</span></div><div class="line"><span class="comment"> */</span></div><div class="line">Route::group([<span class="string">'namespace'</span> =&gt; <span class="string">'Backend'</span>, <span class="string">'prefix'</span> =&gt; <span class="string">'admin'</span>, <span class="string">'middleware'</span> =&gt; <span class="string">'admin'</span>], <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * These routes need view-backend permission</span></div><div class="line"><span class="comment">     * (good if you want to allow more than one group in the backend,</span></div><div class="line"><span class="comment">     * then limit the backend features by different roles or permissions)</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">Note:</span> Administrator has all permissions so you do not have to specify the administrator role everywhere.</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">require</span> (<span class="keyword">__DIR__</span> . <span class="string">'/Routes/Backend/Dashboard.php'</span>);</div><div class="line">    <span class="keyword">require</span> (<span class="keyword">__DIR__</span> . <span class="string">'/Routes/Backend/Access.php'</span>);</div><div class="line">    <span class="keyword">require</span> (<span class="keyword">__DIR__</span> . <span class="string">'/Routes/Backend/LogViewer.php'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h4 id="保持组命名空间与目录一致"><a href="#保持组命名空间与目录一致" class="headerlink" title="保持组命名空间与目录一致"></a>保持组命名空间与目录一致</h4><p>因为组模块下的相应路由文件中会使用到<code>控制器</code>来指定路由，并且在 <code>boilerplate</code>中控制器也是以模块组的目录结构来建立的,<br>而该模块组中的命名空间是以<code>composer.json</code>文件中的 <code>autoload</code> <code>psr-4</code> 的规范来定义的,<br>比如 <code>app/Http/Controllers/Backend/DashboardController.php</code> 的命名空间就是<code>App\Http\Controllers\Backend</code>,<br>为了在子路由下不必重复的编写命名空间引入控制器，可以在路由组中加入<code>namespace</code>来指定当前组所在的命名空间.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 模块组路由中</span></div><div class="line">Route::group([<span class="string">'namespace'</span> =&gt; <span class="string">'Frontend'</span>], <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">  <span class="comment">// 当前组的命名空间为 /App/Http/Controllers/Frontend</span></div><div class="line">      <span class="keyword">require</span> (<span class="keyword">__DIR__</span> . <span class="string">'/Routes/Frontend/Frontend.php'</span>);</div><div class="line">      <span class="keyword">require</span> (<span class="keyword">__DIR__</span> . <span class="string">'/Routes/Frontend/Access.php'</span>);</div><div class="line">  &#125;);</div></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Routes/frontend/frontend.php</span></div><div class="line"><span class="comment">// 引入FrontendController控制器 该控制器对应的命名空间为 /App/Http/Controllers/Frontend</span></div><div class="line"><span class="comment">// 如果模块组中未定义命名空间 则自动检索 /App/Http/Controllers 命名空间 会提示找不到，因为该文件并不在这个命名空间下</span></div><div class="line">Route::get(<span class="string">'macros'</span>, <span class="string">'FrontendController@macros'</span>)-&gt;name(<span class="string">'frontend.macros'</span>);</div></pre></td></tr></table></figure>
<h4 id="命名路由"><a href="#命名路由" class="headerlink" title="命名路由"></a>命名路由</h4><p>对详细路由进行命名，方便在视图中进行跳转</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// router</span></div><div class="line">Route::get(<span class="string">'/'</span>, <span class="string">'FrontendController@index'</span>)-&gt;name(<span class="string">'frontend.index'</span>);</div><div class="line"></div><div class="line"><span class="comment">// view</span></div><div class="line">&lt;a href="&#123;!! route('frontend.index') !!&#125;" class="logo"&gt;&#123;!! app_name() !!&#125;&lt;/a&gt;</div></pre></td></tr></table></figure>
<h3 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h3><p><strong>控制器</strong>的主要作用是便于管理路由，对相应路由的业务逻辑的实现集中在这里处理或传递。</p>
<p><code>boilerplate</code>在控制器的目录结构上也进行了整理，在<code>app\Http\Controllers</code>目录下建立的三个目录对控制器进行了归类整理：</p>
<ul>
<li>Backend</li>
<li>Frontend</li>
<li>Language</li>
</ul>
<p>在这些目录下根据业务需求建立另外一些归类目录，便于控制器的集中化管理。<br>例如目录<code>app\Http\Controllers\Frontend\User</code>目录集中管理前端的用户相关的路由的实现:</p>
<ul>
<li>DashboardController.php  用户中心仪表盘控制器</li>
<li>ProfileController.php 用户文件控制器 （实现用户个人文档操作路由的相关业务逻辑）</li>
</ul>
<p>在控制器中一般我们只根据路由做业务的接入和结果的输出，而不是仅仅将业务的处理逻辑全扔进控制器控制的函数中，</p>
<p>如果是这样的话，控制器会非常的臃肿，而且相关业务功能不能做到很好的复用。</p>
<p>如果需求变更的话，我们不得不删除原先的业务逻辑重新编写新的业务逻辑。</p>
<p><code>boilerplate</code>中使用<code>contracts（契约接口）</code>的形式来管理这些逻辑的复用， 并且这种做法，提供了很好的可扩展性，如果业务变更，我们只需要提供一个实现了<code>contracts（契约接口）</code>的类文件就可以了，而不需要去修改之前业务的类文件。</p>
<p>让我们来看一下 <code>boilerplate</code>中的控制器：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"></div><div class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Backend</span>\<span class="title">Access</span>\<span class="title">User</span>;</div><div class="line"></div><div class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Controller</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Requests</span>\<span class="title">Backend</span>\<span class="title">Access</span>\<span class="title">User</span>\<span class="title">EditUserRequest</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Requests</span>\<span class="title">Backend</span>\<span class="title">Access</span>\<span class="title">User</span>\<span class="title">MarkUserRequest</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Requests</span>\<span class="title">Backend</span>\<span class="title">Access</span>\<span class="title">User</span>\<span class="title">StoreUserRequest</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Requests</span>\<span class="title">Backend</span>\<span class="title">Access</span>\<span class="title">User</span>\<span class="title">CreateUserRequest</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Requests</span>\<span class="title">Backend</span>\<span class="title">Access</span>\<span class="title">User</span>\<span class="title">UpdateUserRequest</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Requests</span>\<span class="title">Backend</span>\<span class="title">Access</span>\<span class="title">User</span>\<span class="title">DeleteUserRequest</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Requests</span>\<span class="title">Backend</span>\<span class="title">Access</span>\<span class="title">User</span>\<span class="title">RestoreUserRequest</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Repositories</span>\<span class="title">Backend</span>\<span class="title">Access</span>\<span class="title">User</span>\<span class="title">UserRepositoryContract</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Repositories</span>\<span class="title">Backend</span>\<span class="title">Access</span>\<span class="title">Role</span>\<span class="title">RoleRepositoryContract</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Requests</span>\<span class="title">Backend</span>\<span class="title">Access</span>\<span class="title">User</span>\<span class="title">ChangeUserPasswordRequest</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Requests</span>\<span class="title">Backend</span>\<span class="title">Access</span>\<span class="title">User</span>\<span class="title">UpdateUserPasswordRequest</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Requests</span>\<span class="title">Backend</span>\<span class="title">Access</span>\<span class="title">User</span>\<span class="title">PermanentlyDeleteUserRequest</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Requests</span>\<span class="title">Backend</span>\<span class="title">Access</span>\<span class="title">User</span>\<span class="title">ResendConfirmationEmailRequest</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Repositories</span>\<span class="title">Backend</span>\<span class="title">Access</span>\<span class="title">Permission</span>\<span class="title">PermissionRepositoryContract</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Repositories</span>\<span class="title">Frontend</span>\<span class="title">Access</span>\<span class="title">User</span>\<span class="title">UserRepositoryContract</span> <span class="title">as</span> <span class="title">FrontendUserRepositoryContract</span>;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Class UserController</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * <span class="doctag">@var</span> UserRepositoryContract</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">protected</span> $users;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * <span class="doctag">@var</span> RoleRepositoryContract</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">protected</span> $roles;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * <span class="doctag">@var</span> PermissionRepositoryContract</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">protected</span> $permissions;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> UserRepositoryContract       $users</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> RoleRepositoryContract       $roles</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> PermissionRepositoryContract $permissions</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(</span></span></div><div class="line"><span class="function"><span class="params">        UserRepositoryContract $users,</span></span></div><div class="line"><span class="function"><span class="params">        RoleRepositoryContract $roles,</span></span></div><div class="line"><span class="function"><span class="params">        PermissionRepositoryContract $permissions</span></span></div><div class="line"><span class="function"><span class="params">    )</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;users       = $users;</div><div class="line">        <span class="keyword">$this</span>-&gt;roles       = $roles;</div><div class="line">        <span class="keyword">$this</span>-&gt;permissions = $permissions;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">return</span> view(<span class="string">'backend.access.index'</span>)</div><div class="line">            -&gt;withUsers(<span class="keyword">$this</span>-&gt;users-&gt;getUsersPaginated(config(<span class="string">'access.users.default_per_page'</span>), <span class="number">1</span>));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span>  CreateUserRequest $request</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">create</span><span class="params">(CreateUserRequest $request)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">return</span> view(<span class="string">'backend.access.create'</span>)</div><div class="line">            -&gt;withRoles(<span class="keyword">$this</span>-&gt;roles-&gt;getAllRoles(<span class="string">'sort'</span>, <span class="string">'asc'</span>, <span class="keyword">true</span>))</div><div class="line">            -&gt;withPermissions(<span class="keyword">$this</span>-&gt;permissions-&gt;getAllPermissions());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span>  StoreUserRequest $request</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span><span class="params">(StoreUserRequest $request)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;users-&gt;create(</div><div class="line">            $request-&gt;except(<span class="string">'assignees_roles'</span>, <span class="string">'permission_user'</span>),</div><div class="line">            $request-&gt;only(<span class="string">'assignees_roles'</span>),</div><div class="line">            $request-&gt;only(<span class="string">'permission_user'</span>)</div><div class="line">        );</div><div class="line">        <span class="keyword">return</span> redirect()-&gt;route(<span class="string">'admin.access.users.index'</span>)-&gt;withFlashSuccess(trans(<span class="string">'alerts.backend.users.created'</span>));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span>  $id</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span>  EditUserRequest $request</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">edit</span><span class="params">($id, EditUserRequest $request)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        $user = <span class="keyword">$this</span>-&gt;users-&gt;findOrThrowException($id, <span class="keyword">true</span>);</div><div class="line">        <span class="keyword">return</span> view(<span class="string">'backend.access.edit'</span>)</div><div class="line">            -&gt;withUser($user)</div><div class="line">            -&gt;withUserRoles($user-&gt;roles-&gt;lists(<span class="string">'id'</span>)-&gt;all())</div><div class="line">            -&gt;withRoles(<span class="keyword">$this</span>-&gt;roles-&gt;getAllRoles(<span class="string">'sort'</span>, <span class="string">'asc'</span>, <span class="keyword">true</span>))</div><div class="line">            -&gt;withUserPermissions($user-&gt;permissions-&gt;lists(<span class="string">'id'</span>)-&gt;all())</div><div class="line">            -&gt;withPermissions(<span class="keyword">$this</span>-&gt;permissions-&gt;getAllPermissions());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span>  $id</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span>  UpdateUserRequest $request</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">($id, UpdateUserRequest $request)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;users-&gt;update($id,</div><div class="line">            $request-&gt;except(<span class="string">'assignees_roles'</span>, <span class="string">'permission_user'</span>),</div><div class="line">            $request-&gt;only(<span class="string">'assignees_roles'</span>),</div><div class="line">            $request-&gt;only(<span class="string">'permission_user'</span>)</div><div class="line">        );</div><div class="line">        <span class="keyword">return</span> redirect()-&gt;route(<span class="string">'admin.access.users.index'</span>)-&gt;withFlashSuccess(trans(<span class="string">'alerts.backend.users.updated'</span>));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span>  $id</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span>  DeleteUserRequest $request</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">destroy</span><span class="params">($id, DeleteUserRequest $request)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;users-&gt;destroy($id);</div><div class="line">        <span class="keyword">return</span> redirect()-&gt;back()-&gt;withFlashSuccess(trans(<span class="string">'alerts.backend.users.deleted'</span>));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span>  $id</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span>  PermanentlyDeleteUserRequest $request</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">delete</span><span class="params">($id, PermanentlyDeleteUserRequest $request)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;users-&gt;delete($id);</div><div class="line">        <span class="keyword">return</span> redirect()-&gt;back()-&gt;withFlashSuccess(trans(<span class="string">'alerts.backend.users.deleted_permanently'</span>));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span>  $id</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span>  RestoreUserRequest $request</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">restore</span><span class="params">($id, RestoreUserRequest $request)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;users-&gt;restore($id);</div><div class="line">        <span class="keyword">return</span> redirect()-&gt;back()-&gt;withFlashSuccess(trans(<span class="string">'alerts.backend.users.restored'</span>));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span>  $id</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span>  $status</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span>  MarkUserRequest $request</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">mark</span><span class="params">($id, $status, MarkUserRequest $request)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;users-&gt;mark($id, $status);</div><div class="line">        <span class="keyword">return</span> redirect()-&gt;back()-&gt;withFlashSuccess(trans(<span class="string">'alerts.backend.users.updated'</span>));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">deactivated</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">return</span> view(<span class="string">'backend.access.deactivated'</span>)</div><div class="line">            -&gt;withUsers(<span class="keyword">$this</span>-&gt;users-&gt;getUsersPaginated(<span class="number">25</span>, <span class="number">0</span>));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">deleted</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">return</span> view(<span class="string">'backend.access.deleted'</span>)</div><div class="line">            -&gt;withUsers(<span class="keyword">$this</span>-&gt;users-&gt;getDeletedUsersPaginated(<span class="number">25</span>));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span>  $id</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span>  ChangeUserPasswordRequest $request</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">changePassword</span><span class="params">($id, ChangeUserPasswordRequest $request)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">return</span> view(<span class="string">'backend.access.change-password'</span>)</div><div class="line">            -&gt;withUser(<span class="keyword">$this</span>-&gt;users-&gt;findOrThrowException($id));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span>  $id</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span>  UpdateUserPasswordRequest $request</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">updatePassword</span><span class="params">($id, UpdateUserPasswordRequest $request)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;users-&gt;updatePassword($id, $request-&gt;all());</div><div class="line">        <span class="keyword">return</span> redirect()-&gt;route(<span class="string">'admin.access.users.index'</span>)-&gt;withFlashSuccess(trans(<span class="string">'alerts.backend.users.updated_password'</span>));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span>  $user_id</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span>  FrontendUserRepositoryContract $user</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span>  ResendConfirmationEmailRequest $request</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">resendConfirmationEmail</span><span class="params">($user_id, FrontendUserRepositoryContract $user, ResendConfirmationEmailRequest $request)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        $user-&gt;sendConfirmationEmail($user_id);</div><div class="line">        <span class="keyword">return</span> redirect()-&gt;back()-&gt;withFlashSuccess(trans(<span class="string">'alerts.backend.users.confirmation_email'</span>));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们会发现<code>UserController</code>中的路由控制函数都非常的精简，每个控制函数都只有仅仅数行代码。<br>我们以<code>store</code>新增用户函数来追踪一下代码到底是怎么运行的。<br>该方法会在路由提交新增用户请求时进行处理，先经过依赖注入<code>StoreUserRequest</code>（文件地址<code>app\Http\Requests\Backend\Access\User\StoreUserRequest.php</code>）实例来判断Post过来的数据是不是经得起验证，如果数据是合法的，就执行该控制函数下的代码。<br>我们看下<code>store</code>函数会发现主要实现的业务逻辑都集中在<code>$this-&gt;user</code>实例的<code>create</code>方法中，<br>而<code>$this-&gt;user</code>是<code>Usercontroller</code>初始化时直接通过依赖注入构造的<code>UserRepositoryContract</code>类的实例，<br>该实例在 <code>AccessServiceProvider</code>中的<code>registerBindings</code>方法注册，实际上是从容器中提取的<code>EloquentUserRepository</code>的实例。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// app/Providers/AccessServiceProvider.php</span></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">   * Register service provider bindings</span></div><div class="line"><span class="comment">   */</span></div><div class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">registerBindings</span><span class="params">()</span></span></div><div class="line"><span class="function">  </span>&#123;</div><div class="line">      <span class="keyword">$this</span>-&gt;app-&gt;bind(</div><div class="line">          \App\Repositories\Frontend\Access\User\UserRepositoryContract::class,</div><div class="line">          \App\Repositories\Frontend\Access\User\EloquentUserRepository::class</div><div class="line">      );</div><div class="line"></div><div class="line">      <span class="keyword">$this</span>-&gt;app-&gt;bind(</div><div class="line">          \App\Repositories\Backend\Access\User\UserRepositoryContract::class,</div><div class="line">          \App\Repositories\Backend\Access\User\EloquentUserRepository::class</div><div class="line">      );</div><div class="line"></div><div class="line">      <span class="keyword">$this</span>-&gt;app-&gt;bind(</div><div class="line">          \App\Repositories\Backend\Access\Role\RoleRepositoryContract::class,</div><div class="line">          \App\Repositories\Backend\Access\Role\EloquentRoleRepository::class</div><div class="line">      );</div><div class="line"></div><div class="line">      <span class="keyword">$this</span>-&gt;app-&gt;bind(</div><div class="line">          \App\Repositories\Backend\Access\Permission\PermissionRepositoryContract::class,</div><div class="line">          \App\Repositories\Backend\Access\Permission\EloquentPermissionRepository::class</div><div class="line">      );</div><div class="line"></div><div class="line">      <span class="keyword">$this</span>-&gt;app-&gt;bind(</div><div class="line">          \App\Repositories\Backend\Access\Permission\Group\PermissionGroupRepositoryContract::class,</div><div class="line">          \App\Repositories\Backend\Access\Permission\Group\EloquentPermissionGroupRepository::class</div><div class="line">      );</div><div class="line"></div><div class="line">      <span class="keyword">$this</span>-&gt;app-&gt;bind(</div><div class="line">          \App\Repositories\Backend\Access\Permission\Dependency\PermissionDependencyRepositoryContract::class,</div><div class="line">          \App\Repositories\Backend\Access\Permission\Dependency\EloquentPermissionDependencyRepository::class</div><div class="line">      );</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>我们看下<code>EloquentUserRepository</code>这个类，这个类才是真正的实现业务逻辑的类，它实现了<code>create</code>业务方法生成一个新的用户。<br>如果我们业务变更，需求用另一种实现来生成另外一种用户,这时候我们只需建立一个<code>SomeOtherUserRepository</code>并实现<code>UserRepositoryContracts</code>，然后再修改在容器中的注册就可以了，而完全不需要去修改<code>EloquentUserRepository</code>中的实现了。</p>
<h3 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h3><p><strong>boilerplate</strong>将模型都集中在了<code>app\Models</code>目录下进行统一管理。</p>
<p>这里我们主要分析一下用户模型，而用户相关的文件存放在 <code>app\Models\Access\User\</code>目录下，在该目录下<code>User.php</code>就是用户模型，该模型继承了<code>Illuminate\Database\Eloquent\Model</code>。</p>
<p>我们发现<code>User.php</code>文件下内容非常的清爽，而<code>User</code>目录下建立了<code>Traits</code>目录用来存放, 而<code>User.php</code>里也使用了trait来引用不同的文件。 </p>
<p><strong>trait</strong>是自php 5.4.0 起实现代码复用的一个方法，它和类相似，但自身不能实例化，类似于前端语言里的<code>[mixin]</code>方式复用方法。</p>
<p><strong>boilerplate</strong>将用户模型中不同职责的方法分别独立出了一个trait文件，方便了功能方法的复用，文件的职责更加明确.</p>
<h3 id="helpers"><a href="#helpers" class="headerlink" title="helpers"></a>helpers</h3><p><code>app/helpers.php</code>文件中封装了一些全局方法，该文件在<code>composer.json</code>文件中定义了<code>autoload</code>, 在由composer解析生成依赖文件后，会在程序启动中进行自动加载. 一些常用的方法可以在这里定义简便形式。</p>
<h2 id="技能get"><a href="#技能get" class="headerlink" title="技能get"></a>技能get</h2><h3 id="Seed"><a href="#Seed" class="headerlink" title="Seed"></a>Seed</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">Model::unguard();</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (env(<span class="string">'DB_CONNECTION'</span>) == <span class="string">'mysql'</span>) &#123;</div><div class="line">      <span class="comment">// 取消外键约束</span></div><div class="line">        DB::statement(<span class="string">'SET FOREIGN_KEY_CHECKS=0;'</span>); </div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">$this</span>-&gt;call(AccessTableSeeder::class);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (env(<span class="string">'DB_CONNECTION'</span>) == <span class="string">'mysql'</span>) &#123;</div><div class="line">      <span class="comment">// 使外键约束生效</span></div><div class="line">        DB::statement(<span class="string">'SET FOREIGN_KEY_CHECKS=1;'</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"> Model::reguard();</div></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><p>优秀的目录结构使代码结构更清晰，模块职责明确，这样在未来新增功能或维护功能时，可以非常迅速的定位到相应的的位置，提高了扩展的效率，提高了可维护性。</p>
<h3 id="业务实现"><a href="#业务实现" class="headerlink" title="业务实现"></a>业务实现</h3><p>考虑需求变更的可能性，提高业务的复用性，可扩展性。使用 <code>contracts</code>的形式去规划业务，可能刚开始编写代码的时候会多做很多事情，但是后期的维护上却会节省很大的效率。</p>
<h3 id="研究开源项目源码的好处"><a href="#研究开源项目源码的好处" class="headerlink" title="研究开源项目源码的好处"></a>研究开源项目源码的好处</h3><p>记得以前玩游戏的时候，玩不过了怎么办？我们经常做的就是研究攻略找秘籍，编程也是一样的，读一些优秀的开源项目的源码，可以让我们学习到非常多的东西，提高我们的编程视角，往往能够收获颇多。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/03/31/wechat-not-support-promise-on-android/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dearmadman">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Team.dearmadman.com">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/03/31/wechat-not-support-promise-on-android/" itemprop="url">安卓端微信浏览器不支持 promise</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-03-31T11:55:26+08:00">
                2016-03-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="关于微信不支持es6的promise特性的解决方案"><a href="#关于微信不支持es6的promise特性的解决方案" class="headerlink" title="关于微信不支持es6的promise特性的解决方案"></a>关于微信不支持es6的promise特性的解决方案</h1><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>  最近使用es6的promise特性重构了一下微信端的点餐系统。完成后发现安卓版本的微信不能正常运作，而itouch却可以正常运行。<br>  于是开始了bug调试踩坑的旅程…</p>
<p>  刚开始发现程序不能运行正确，但是微信的调试工具并没有报任何的错误，我以为是缓存问题，想进了一切办法去解决缓存问题，然并软。<br>  然后发现VueComponent并没有得到正确的解析，于是探索为何dom节点没有被Component替换，这个坑踩了三个多小时，最后才想起是不是<br>  es6不支持的问题。。。</p>
<p>  于是,进行验证，发现只有使用了promise相关的component没有被正确解析，而未使用promise的组件解析正常，才确定下来是es6特性不支持的问题。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>  引入polyfill支持es6的promise特性</p>
  <figure class="highlight livescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">npm</span> install es6-promise --save</div><div class="line"><span class="comment"># use</span></div><div class="line"><span class="keyword">var</span> Promise = <span class="built_in">require</span>(<span class="string">'es6-promise'</span>).Promise</div></pre></td></tr></table></figure>
<p>  重新打包生成，运行正确</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>  类似的场景应该会非常常见，引入javascript新版本的高级特性确实能有效的提高开发效率，但是需要考虑低版本的浏览器支持的问题，<br>  尽量去引用一些polyfill去支持这些特性，不然调试微信这样的bug确实是非常浪费时间一件事。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/03/28/front-end-developer-interview-questions/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dearmadman">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Team.dearmadman.com">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/03/28/front-end-developer-interview-questions/" itemprop="url">如何有效的面试前端工程师</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-03-28T11:19:32+08:00">
                2016-03-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="如何面试前端开发工程师？"><a href="#如何面试前端开发工程师？" class="headerlink" title="如何面试前端开发工程师？"></a>如何面试前端开发工程师？</h1><p>  我们应该如何迅速有效的面试到优秀前端工程师？</p>
<h2 id="考核范围"><a href="#考核范围" class="headerlink" title="考核范围"></a>考核范围</h2><p>  一个优秀的前端工程师应具备以下基本的素质：</p>
<h3 id="技能的深度"><a href="#技能的深度" class="headerlink" title="技能的深度"></a>技能的深度</h3><h4 id="初级"><a href="#初级" class="headerlink" title="初级"></a>初级</h4><ul>
<li>读过哪些前端技能的书籍</li>
<li>获取前端技能的途径</li>
<li>在线学习的社区</li>
<li>爱逛的前端社区</li>
<li>已掌握的技能</li>
<li>常用工具类库</li>
</ul>
<h4 id="中级"><a href="#中级" class="headerlink" title="中级"></a>中级</h4><ul>
<li>编写过哪些插件</li>
<li>常用框架</li>
<li>已掌握的mvc框架</li>
<li>javascript 高阶函数</li>
<li>对mvc及mvvm的理解</li>
<li>Http协议</li>
<li>前端常用优化技巧</li>
<li>为哪些开源项目做出过贡献</li>
</ul>
<h4 id="高级"><a href="#高级" class="headerlink" title="高级"></a>高级</h4><ul>
<li>es6</li>
<li>前端规范</li>
<li>函数式编程</li>
<li>模块化思想</li>
<li>构建工具</li>
<li>github</li>
<li>stackoverflow</li>
<li>vue/react/angular</li>
<li>常用设计模式</li>
<li>后端项目经验</li>
</ul>
<h3 id="职业态度"><a href="#职业态度" class="headerlink" title="职业态度"></a>职业态度</h3><p>  主要考核从业者对职业的热情程度，有没有职业规划，是否正视自己的第一职业意愿</p>
<h3 id="学习能力"><a href="#学习能力" class="headerlink" title="学习能力"></a>学习能力</h3><p>  是否热爱学习，喜欢分享，有哪些分享经历，有哪些提高个人效率或工作效率的技巧可以分享与我？</p>
<h3 id="协作能力"><a href="#协作能力" class="headerlink" title="协作能力"></a>协作能力</h3><p>  有没有协作经验，以往的协作方式是什么样的？所向往的团队应该是怎么样的？</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/9/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Dearmadman</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">100</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Dearmadman</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
