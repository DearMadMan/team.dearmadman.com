<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Team.dearmadman.com">
<meta property="og:url" content="http://yoursite.com/page/8/index.html">
<meta property="og:site_name" content="Team.dearmadman.com">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Team.dearmadman.com">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/8/"/>





  <title>Team.dearmadman.com</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Team.dearmadman.com</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Just do it.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/18/laravel-from-scratch-contracts/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dearmadman">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Team.dearmadman.com">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/18/laravel-from-scratch-contracts/" itemprop="url">laravel 基础教程 —— 契约</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-05-18T16:28:06+08:00">
                2016-05-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="契约"><a href="#契约" class="headerlink" title="契约"></a>契约</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>laravel 的契约是对应用框架的核心服务所要求的一种强有力的约束。它本身定义一些接口，要求服务必须要遵守。比如，<code>Illuminate\Contracts\Queue\Queue</code> 契约定义了队列任务所必须的方法，而 <code>Illuminate\Contracts\Mail\Mailer</code> 契约定义了一些发送邮件所必须的方法。</p>
<p>每种契约在框架中都有相应的提供者去进行实现。比如，laravel 提供了多种驱动的队列任务的实现，还有其中一个的邮件服务的实现是由 <a href="http://swiftmailer.org/" target="_blank" rel="external">SwiftMailer</a> 集成的。</p>
<p>所有的 laravel 契约你都可以在这里找到：<a href="https://github.com/illuminate/contracts" target="_blank" rel="external">GitHub</a>。这里提供了一个对 laravel 契约参考的快速入口，你可以很好的对这些单一解耦的包进行独立实现的开发。</p>
<h3 id="契约-Vs-假面（Facades）"><a href="#契约-Vs-假面（Facades）" class="headerlink" title="契约 Vs. 假面（Facades）"></a>契约 Vs. 假面（Facades）</h3><p>laravel 的假面模式提供了一种简单的方法去从服务容器中取出服务而不需要使用类型提示。使用契约可以使你明确的定义类间的依赖。而对于大多数应用来说，使用假面模式就可以了。但是，如果你想要松耦合易扩展的服务，那么契约可以实现。</p>
<h2 id="为什么使用契约？"><a href="#为什么使用契约？" class="headerlink" title="为什么使用契约？"></a>为什么使用契约？</h2><p>对于契约，你可能会产生很多的疑问。为什么要总是使用接口？使用接口不是会变的更复杂吗？让我们来提炼一下使用接口的原因：松耦合和简洁性。</p>
<h3 id="松耦合"><a href="#松耦合" class="headerlink" title="松耦合"></a>松耦合</h3><p>首先，让我们来看一下一个紧耦合的关于缓存的实现，请阅读下面的代码好好思考一下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"></div><div class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Orders</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Repository</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">  <span class="comment">/**</span></div><div class="line"><span class="comment">   * The cache instance.</span></div><div class="line"><span class="comment">   */</span></div><div class="line">   <span class="keyword">protected</span> $cache;</div><div class="line"></div><div class="line">   <span class="comment">/**</span></div><div class="line"><span class="comment">    * Create a new repository instance.</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * <span class="doctag">@param</span> \SomePackage\Cache\Memcached $cache</span></div><div class="line"><span class="comment">    * <span class="doctag">@return</span> void</span></div><div class="line"><span class="comment">    */</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(\SomePackage\Cache\Memcatched $cache)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">      <span class="keyword">$this</span>-&gt;cache = $cache;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * Retrieve an Order by ID.</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> int $id</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> Order</span></div><div class="line"><span class="comment">     */</span></div><div class="line">     <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">find</span><span class="params">($id)</span></span></div><div class="line"><span class="function">     </span>&#123;</div><div class="line">       <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;cache-&gt;has($id)) &#123;</div><div class="line">          <span class="comment">//</span></div><div class="line">       &#125;</div><div class="line">     &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在上面的类中，代码给予了类一个紧耦合的缓存的实现。之所以说是紧耦合的，是因为它依赖于一个具体的实现类，也就是说它和这个包的供应商是紧密耦合的。如果我们需要换一个包的供应商，那么我们就要修改我们的代码。</p>
<p>同样的，如果我们想要切换我们的底层缓存驱动，从 memcached 切换到 redis，那么我们也必须要修改大量的业务代码。所以，鉴于此，我们的资料库不应该对所提供的依赖需要知道的太多，而仅仅需要知道他们提供了我们所需的就可以了（这和鸭子类型的故事有点相似）。</p>
<p>鉴于此，我们可以采取一种与上述相反的方法来进行解耦。我们提供一个无关具体实现的接口：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"></div><div class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Orders</span>;</div><div class="line"></div><div class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Cache</span>\<span class="title">Repository</span> <span class="title">as</span> <span class="title">Cache</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Respository</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">  <span class="comment">/**</span></div><div class="line"><span class="comment">   * The cache instance.</span></div><div class="line"><span class="comment">   */</span></div><div class="line">   <span class="keyword">protected</span> $cache;</div><div class="line"></div><div class="line">   <span class="comment">/**</span></div><div class="line"><span class="comment">    * Create a new repository instance.</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * <span class="doctag">@param</span> Cache $cache</span></div><div class="line"><span class="comment">    * <span class="doctag">@return</span> void</span></div><div class="line"><span class="comment">    */</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(Cache $cache)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">      <span class="keyword">$this</span>-&gt;cache = $cache;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在上面的代码并没有连接到任何的具体实现库，甚至是 laravel。因为契约只定义了接口，它并不包含任何的依赖和实现，所以你可以非常简单的去实现任何给定的契约，你只需要根据契约编写一个不同的实现就可以进行轻松的替换。而并不用修改之前写过的代码。</p>
<h3 id="简单"><a href="#简单" class="headerlink" title="简单"></a>简单</h3><p>当所有的 laravel 的服务都通过简单整洁的接口进行定义，那么它就可以被非常轻松的确定所给定服务具有哪些功能。这样也可以说 laravel 的契约服务其实是已经提供了简洁的功能文档了。</p>
<h2 id="契约参考"><a href="#契约参考" class="headerlink" title="契约参考"></a>契约参考</h2><p>下面是 laravel 契约及其对应的假面的参考:</p>
<table>
<thead>
<tr>
<th>Contract</th>
<th>References Facade</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Auth/Factory.php" target="_blank" rel="external">Illuminate\Contracts\Auth\Factory</a></td>
<td>Auth</td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Auth/PasswordBroker.php" target="_blank" rel="external">Illuminate\Contracts\Auth\PasswordBroker</a></td>
<td>Password</td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Bus/Dispatcher.php" target="_blank" rel="external">Illuminate\Contracts\Bus\Dispatcher</a></td>
<td>Bus</td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Broadcasting/Broadcaster.php" target="_blank" rel="external">Illuminate\Contracts\Broadcasting\Broadcaster</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Cache/Repository.php" target="_blank" rel="external">Illuminate\Contracts\Cache\Repository</a></td>
<td>Cache</td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Cache/Factory.php" target="_blank" rel="external">Illuminate\Contracts\Cache\Factory</a></td>
<td>Cache::driver()</td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Config/Repository.php" target="_blank" rel="external">Illuminate\Contracts\Config\Repository</a></td>
<td>Config</td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Container/Container.php" target="_blank" rel="external">Illuminate\Contracts\Container\Container</a></td>
<td>App</td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Cookie/Factory.php" target="_blank" rel="external">Illuminate\Contracts\Cookie\Factory</a></td>
<td>Cookie</td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Cookie/QueueingFactory.php" target="_blank" rel="external">Illuminate\Contracts\Cookie\QueueingFactory</a></td>
<td>Cookie::queue()</td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Encryption/Encrypter.php" target="_blank" rel="external">Illuminate\Contracts\Encryption\Encrypter</a></td>
<td>Crypt</td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Events/Dispatcher.php" target="_blank" rel="external">Illuminate\Contracts\Events\Dispatcher</a></td>
<td>Event</td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Filesystem/Cloud.php" target="_blank" rel="external">Illuminate\Contracts\Filesystem\Cloud</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Filesystem/Factory.php" target="_blank" rel="external">Illuminate\Contracts\Filesystem\Factory</a></td>
<td>File</td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Filesystem/Filesystem.php" target="_blank" rel="external">Illuminate\Contracts\Filesystem\Filesystem</a></td>
<td>File</td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Foundation/Application.php" target="_blank" rel="external">Illuminate\Contracts\Foundation\Application</a></td>
<td>App</td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Hashing/Hasher.php" target="_blank" rel="external">Illuminate\Contracts\Hashing\Hasher</a></td>
<td>Hash</td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Logging/Log.php" target="_blank" rel="external">Illuminate\Contracts\Logging\Log</a></td>
<td>Log</td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Mail/MailQueue.php" target="_blank" rel="external">Illuminate\Contracts\Mail\MailQueue</a></td>
<td>Mail::queue()</td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Mail/Mailer.php" target="_blank" rel="external">Illuminate\Contracts\Mail\Mailer</a></td>
<td>Mail</td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Queue/Factory.php" target="_blank" rel="external">Illuminate\Contracts\Queue\Factory</a></td>
<td>Queue::driver()</td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Queue/Queue.php" target="_blank" rel="external">Illuminate\Contracts\Queue\Queue</a></td>
<td>Queue</td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Redis/Database.php" target="_blank" rel="external">Illuminate\Contracts\Redis\Database</a></td>
<td>Redis</td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Routing/Registrar.php" target="_blank" rel="external">Illuminate\Contracts\Routing\Registrar</a></td>
<td>Route</td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Routing/ResponseFactory.php" target="_blank" rel="external">Illuminate\Contracts\Routing\ResponseFactory</a></td>
<td>Response</td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Routing/UrlGenerator.php" target="_blank" rel="external">Illuminate\Contracts\Routing\UrlGenerator</a></td>
<td>URL</td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Support/Arrayable.php" target="_blank" rel="external">Illuminate\Contracts\Support\Arrayable</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Support/Jsonable.php" target="_blank" rel="external">Illuminate\Contracts\Support\Jsonable</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Support/Renderable.php" target="_blank" rel="external">Illuminate\Contracts\Support\Renderable</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Validation/Factory.php" target="_blank" rel="external">Illuminate\Contracts\Validation\Factory</a></td>
<td>Validator::make()</td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/Validation/Validator.php" target="_blank" rel="external">Illuminate\Contracts\Validation\Validator</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/View/Factory.php" target="_blank" rel="external">Illuminate\Contracts\View\Factory</a></td>
<td>View::make()</td>
</tr>
<tr>
<td><a href="https://github.com/illuminate/contracts/blob/master/View/View.php" target="_blank" rel="external">Illuminate\Contracts\View\View</a></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="怎么使用契约"><a href="#怎么使用契约" class="headerlink" title="怎么使用契约"></a>怎么使用契约</h2><p>那么，如何得到一个契约的实现呢？其实这相当的简单。</p>
<p>在 laravel 中很多类型的类都是通过服务容器来获取的，包括控制器，事件监听器，中间件，队列任务，和路由闭包。所以，你可以直接通过在构造函数中使用类型提示来构造接口依赖，这样在类被解析时会自动的获取契约的实例，我们通过一个简单的例子来看一下:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"></div><div class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Listeners</span>;</div><div class="line"></div><div class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">User</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Events</span>\<span class="title">NewUserRegistered</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Redis</span>\<span class="title">Database</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CacheUserInformation</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">  <span class="comment">/**</span></div><div class="line"><span class="comment">   * The Redis database implementation.</span></div><div class="line"><span class="comment">   */</span></div><div class="line">   <span class="keyword">protected</span> $redis;</div><div class="line"></div><div class="line">   <span class="comment">/**</span></div><div class="line"><span class="comment">    * Create a new event handler instance.</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * <span class="doctag">@param</span> Database $redis</span></div><div class="line"><span class="comment">    @ <span class="doctag">@return</span> void</span></div><div class="line"><span class="comment">    */</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(Database $redis)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">      <span class="keyword">$this</span>-&gt;redis = $redis;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * Handle the event.</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> NewUserRegistered $event</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></div><div class="line"><span class="comment">     */</span></div><div class="line">     <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">(NewUserRegistered $event)</span></span></div><div class="line"><span class="function">     </span>&#123;</div><div class="line">        <span class="comment">//</span></div><div class="line">     &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>一旦事件监听器被解析，服务容器就会读构造函数中的类型提示，然后根据类型提示去注入适当的实例。关于更多的在服务容器中进行类的绑定注册，你可以查看服务容器的文档。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/17/laravel-from-scratch-service-container/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dearmadman">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Team.dearmadman.com">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/17/laravel-from-scratch-service-container/" itemprop="url">laravel 基础教程 —— 服务容器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-05-17T21:11:56+08:00">
                2016-05-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>laravel 提供了强大的服务容器工具来管理类之间的依赖关系并以此来提供依赖注入。依赖注入是一个奇特的短语，其实它的意思是说所依赖的类的实例通过构造函数或者其它的方式被注入到类中。如果你还是不太明白，你可以参考我写的这篇 <a href="http://team.dearmadman.com/2016/04/13/dependency-injection-and-inversion-of-control/" target="_blank" rel="external">《理解依赖注入与控制反转》</a>。</p>
<p>让我们来看一个简单的例子：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"></div><div class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Jobs</span>;</div><div class="line"></div><div class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">User</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Mail</span>\<span class="title">Mailer</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Bus</span>\<span class="title">SelfHandling</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PurchasePodcast</span> <span class="keyword">implements</span> <span class="title">SelfHandling</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * The mailer implementation.</span></div><div class="line"><span class="comment">     */</span></div><div class="line">     <span class="keyword">protected</span> $mailer;</div><div class="line"></div><div class="line">     <span class="comment">/**</span></div><div class="line"><span class="comment">      * Create a new instance.</span></div><div class="line"><span class="comment">      *</span></div><div class="line"><span class="comment">      * <span class="doctag">@param</span> Mailer $mailer</span></div><div class="line"><span class="comment">      * <span class="doctag">@return</span> void</span></div><div class="line"><span class="comment">      */</span></div><div class="line">      <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(Mailer $mailer)</span></span></div><div class="line"><span class="function">      </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;mailer = $mailer;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="comment">/**</span></div><div class="line"><span class="comment">       * Purchase a podcast.</span></div><div class="line"><span class="comment">       *</span></div><div class="line"><span class="comment">       * <span class="doctag">@return</span> void</span></div><div class="line"><span class="comment">       */</span></div><div class="line">       <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">()</span></span></div><div class="line"><span class="function">       </span>&#123;</div><div class="line">          <span class="comment">//</span></div><div class="line">       &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面的例子中 <code>PurchasePodcast</code> 任务需要在播客服务被购买时发送一个 email，所以我们注入了一个可以发送邮件的服务。因为服务是注入进去的而不是类自身硬编码进去的，所以我们可以很容易的切换到其他发送邮件的实现，我们也可以很容易的去 <code>mock</code>，这样我们在做单元测试的时候就很容易去做一些假的数据。</p>
<p>能够更深层次的理解 laravel 的服务容器是非常必要的，它是能够构造强大的应用的关键，服务容器构成了整个 laravel 应用的核心。</p>
<h2 id="绑定"><a href="#绑定" class="headerlink" title="绑定"></a>绑定</h2><p>几乎所有的服务容器的绑定都是在服务提供者中被注册的，所有下面的例子都是在这个环境下进行演示的。如果类并没有依赖什么接口，它是没有必要在容器中进行绑定的。容器并不需要有什么具体的指示去如何构造这些实例，因为他们会根据 PHP 的反射进行自动的实例化。</p>
<p>在服务提供者内部，你可以通过 <code>$this-&gt;app</code> 来访问容器的实例。我们可以使用 <code>bind</code> 方法来注册绑定，这需要传递类或接口名，然后跟上一个 <code>Closure</code> 闭包函数，闭包用来返回一个所绑定类的实例:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">$this</span>-&gt;app-&gt;bind(<span class="string">'HelpSpot\API'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($app)</span> </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> HelpSpot\API($app[<span class="string">'HttpClient'</span>]);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>注意上面的例子，我们将容器的实例作为参数传递到闭包中，这样我们就可以使用容器来解析我们所构建对象的子依赖。</p>
<h3 id="单例式绑定"><a href="#单例式绑定" class="headerlink" title="单例式绑定"></a>单例式绑定</h3><p><code>singleton</code> 方法绑定的类或者接口只会被解析一次，也就是说随后的访问都会返回这个相同的实例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">$this</span>-&gt;app-&gt;singleton(<span class="string">'FooBar'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($app)</span> </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> FooBar($app[<span class="string">'SomethingElse'</span>]);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="直接绑定实例"><a href="#直接绑定实例" class="headerlink" title="直接绑定实例"></a>直接绑定实例</h3><p>你也可以使用 <code>instance</code> 方法来绑定一个已经存在的实例对象到容器中。随后的访问中，容器都会返回这个给定的实例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$fooBar = <span class="keyword">new</span> FooBar(<span class="keyword">new</span> SomethingElse);</div><div class="line"></div><div class="line"><span class="keyword">$this</span>-&gt;app-&gt;instance(<span class="string">'FooBar'</span>, $fooBar);</div></pre></td></tr></table></figure>
<h3 id="绑定接口到实现"><a href="#绑定接口到实现" class="headerlink" title="绑定接口到实现"></a>绑定接口到实现</h3><p>服务容器具有一个非常强大的特性就是能够绑定接口到给定的实现。比如，让我们假设我们有 <code>EventPusher</code> 接口和 <code>RedisEventPusher</code> 实现。一旦我们绑定 <code>RedisEventPusher</code> 实现到这个接口，我们可以在服务容器中这么来进行注册：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">$this</span>-&gt;app-&gt;bind(<span class="string">'App\Contracts\EventPusher'</span>, <span class="string">'App\Services\RedisEventPusher'</span>);</div></pre></td></tr></table></figure>
<p>这就告诉了容器如果类需要一个 <code>EventPusher</code> 的实现时，那就注入一个 <code>RedisEventPusher</code> 的实例。现在我们可以在构造函数或者其他地方来写入 <code>EventPusher</code> 接口的类型提示来进行依赖注入：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Contracts</span>\<span class="title">EventPusher</span>;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Create a new class instance.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * <span class="doctag">@param</span> EventPusher $pusher</span></div><div class="line"><span class="comment"> * <span class="doctag">@return</span> void</span></div><div class="line"><span class="comment"> */</span></div><div class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(EventPusher $pusher)</span></span></div><div class="line"><span class="function"> </span>&#123;</div><div class="line">    <span class="keyword">$this</span>-&gt;pusher = $pusher;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<h3 id="上下文绑定"><a href="#上下文绑定" class="headerlink" title="上下文绑定"></a>上下文绑定</h3><p>有时候你可能会有实现了同一个接口的两个类，而且你想要在不同的场景下注入不同的实现，比如说，当我们的系统接收到了一个订单，我们可能想要通过 <a href="http://www.pubnub.com/" target="_blank" rel="external">PubNub</a> 来发送一个事件，而不是 Pusher。laravel 提供了一种简单流利的接口来定义这种行为：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">$this</span>-&gt;app-&gt;when(<span class="string">'App\Handlers\Commands\CreateOrderHandler'</span>)</div><div class="line">          -&gt;needs(<span class="string">'App\Contracts\EventPusher'</span>)</div><div class="line">          -&gt;give(<span class="string">'App\Services\PubNubEventPusher'</span>);</div></pre></td></tr></table></figure>
<p>你也可以在 <code>give</code> 方法中传递一个 Closure :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">$this</span>-&gt;app-&gt;when(<span class="string">'App\Handlers\Commands\CreateOrderHandler'</span>)</div><div class="line">          -&gt;needs(<span class="string">'App\Contracts\EventPusher'</span>)</div><div class="line">          -&gt;give(<span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">            <span class="comment">// Resolve dependency...</span></div><div class="line">          &#125;);</div></pre></td></tr></table></figure>
<h3 id="绑定原始类型"><a href="#绑定原始类型" class="headerlink" title="绑定原始类型"></a>绑定原始类型</h3><p>有时候你可能需要在类中注入许多的依赖类，但是你可能也需要注入一些 PHP 的原始类型数据，比如说 integer, boolean。你可以在上下文绑定中非常轻松的绑定类所需要的：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">$this</span>-&gt;app-&gt;when(<span class="string">'App\Handlers\Commands\CreateOrderHandler'</span>)</div><div class="line">          -&gt;needs(<span class="string">'$maxOrderCount'</span>)</div><div class="line">          -&gt;give(<span class="number">10</span>);</div></pre></td></tr></table></figure>
<h2 id="标记"><a href="#标记" class="headerlink" title="标记"></a>标记</h2><p>有时候你可能需要解析一些符合某种类别的所有绑定。比如说，你可能需要来建造一个报告聚合器来接收一个包含了不同 <code>Report</code> 接口的实现集。在实现了 <code>Report</code> 的注册之后，你可以使用 <code>tag</code> 方法来给它们打上标记：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">$this</span>-&gt;app-&gt;bind(<span class="string">'SpeedReport'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">  <span class="comment">//  </span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">$this</span>-&gt;app-&gt;bind(<span class="string">'MemoryReport'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">  <span class="comment">// </span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">$this</span>-&gt;app-&gt;tag([<span class="string">'SpeedReport'</span>, <span class="string">'MemoryReport'</span>], <span class="string">'reports'</span>);</div></pre></td></tr></table></figure>
<p>一旦这些服务被打上标记，你可以使用 <code>tagged</code> 方法来解析获得它们:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">$this</span>-&gt;app-&gt;bind(<span class="string">'ReportAggregator'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($app)</span> </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> ReportAggregator($app-&gt;tagged(<span class="string">'reports'</span>));</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><p>laravel 提供了多种方式从服务容器中解析出实例。首先，你可以使用 <code>make</code> 方法，它接收一个你想要解析的类或者接口：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$fooBar = <span class="keyword">$this</span>-&gt;app-&gt;make(<span class="string">'FooBar'</span>);</div></pre></td></tr></table></figure>
<p>其次，你也可以使用数组的方式从容器中解析对象，因为它实现了 PHP 的 <code>ArrayAccess</code> 接口:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$fooBar = <span class="keyword">$this</span>-&gt;app[<span class="string">'FooBar'</span>];</div></pre></td></tr></table></figure>
<p>最后，也是最重要的，你也可以在类的构造函数中简单的使用‘类型提示’来从容器中解析依赖。控制器，事件监听器，队列任务，中间件等都支持这种方式。在实践中，这是大部分对象从容器中解析的方式。</p>
<p>容器会自动的为类进行依赖的注入。比如，你可以在控制器的构造函数中对应用中定义的仓库类进行类型提示。仓库实例会自动的从容器中进行解析并注入到控制器中:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"></div><div class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</div><div class="line"></div><div class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Users</span>\<span class="title">Repository</span> <span class="title">as</span> <span class="title">UserRepository</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">  <span class="comment">/**</span></div><div class="line"><span class="comment">   * The user repository instance.</span></div><div class="line"><span class="comment">   *</span></div><div class="line"><span class="comment">   */</span></div><div class="line">   <span class="keyword">protected</span> $users;</div><div class="line"></div><div class="line">   <span class="comment">/**</span></div><div class="line"><span class="comment">    * Create a new controller instance.</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * <span class="doctag">@param</span> UserRepository $users</span></div><div class="line"><span class="comment">    * <span class="doctag">@return</span> void</span></div><div class="line"><span class="comment">    */</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(UserRepository $users)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">      <span class="keyword">$this</span>-&gt;users = $users;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * Show the user with the given ID.</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> int $id</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> Response</span></div><div class="line"><span class="comment">     */</span></div><div class="line">     <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">($id)</span></span></div><div class="line"><span class="function">     </span>&#123;</div><div class="line">       <span class="comment">//</span></div><div class="line">     &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="容器事件"><a href="#容器事件" class="headerlink" title="容器事件"></a>容器事件</h2><p>容器在每次解析一个对象时都会触发一个事件，你可以通过 <code>resolving</code> 方法来监听这个事件:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">$this</span>-&gt;app-&gt;resolving(<span class="function"><span class="keyword">function</span> <span class="params">($object, $app)</span> </span>&#123;</div><div class="line">  <span class="comment">// Called when container resolves object of any type... </span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">$this</span>-&gt;app-&gt;resolving(FooBar::class, <span class="function"><span class="keyword">function</span> <span class="params">(FooBar $fooBar, $app)</span> </span>&#123;</div><div class="line">  <span class="comment">// Called when container resolves objects of type "FooBar"... </span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>如你所看到的，<code>resolving</code> 方法中你可以传递一个回调函数，回调函数会接收两个参数，一个是解析得到的对象，一个是容器本身，这样你就可以在对象传递到消费者之前添加一些额外的属性。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/15/laravel-from-scratch-service-providers/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dearmadman">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Team.dearmadman.com">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/15/laravel-from-scratch-service-providers/" itemprop="url">laravel 基础教程 —— 服务提供者</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-05-15T21:34:31+08:00">
                2016-05-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>服务提供者是 laravel 应用启动的中心。你自己的应用以及 laravel 的核心服务都是通过服务提供者来启动的。</p>
<p>但是，我们所指的启动是什么意思？通常情况下，这意味着注册，包含注册服务的绑定，事件监听，中间件，和路由。服务提供者是应用配置的中心。</p>
<p>如果你打开 <code>config/app.php</code> 文件，你会发现 <code>providers</code> 数组。这些都是你的应用将要加载的服务提供者类。当然，很多是延迟加载的提供者，意思就是并不是所有的请求都会加载这些提供者，而是只有需要的时候才会加载。</p>
<p>在此篇，你将学会如果去编写自己的服务提供者并且将其注册到应用中。</p>
<h2 id="编写服务提供者"><a href="#编写服务提供者" class="headerlink" title="编写服务提供者"></a>编写服务提供者</h2><p>所有的服务提供者都继承自 <code>Illuminate\Support\ServiceProvider</code> 类。这个抽象类要求你的提供者必须最少定义一个 <code>register</code> 方法。在 <code>register</code> 方法中你应该只绑定内容到服务容器。你永远不要尝试在其中注册任何的事件监听，路由或者其它功能。</p>
<p>Artisan CLI 可以通过 <code>make:provider</code> 命令来非常便捷的生成一个新的提供者:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">php artisan make:provider RiakServiceProvider</div></pre></td></tr></table></figure>
<h3 id="注册方法"><a href="#注册方法" class="headerlink" title="注册方法"></a>注册方法</h3><p>就如前面所提到的，在 <code>register</code> 方法中，你应该只做一件事，那就是绑定事物到服务容器中。不要做其它的事情。否则，可能你所使用的提供者提供的服务还没有被注册。<br>现在，让我们来看一个最基础的服务提供者：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"></div><div class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Providers</span>;</div><div class="line"></div><div class="line"><span class="keyword">use</span> <span class="title">Riak</span>\<span class="title">Connection</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">ServiceProvider</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">RiakServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">  <span class="comment">/**</span></div><div class="line"><span class="comment">   * Register bindings in the container.</span></div><div class="line"><span class="comment">   *</span></div><div class="line"><span class="comment">   * <span class="doctag">@return</span> void</span></div><div class="line"><span class="comment">   */</span></div><div class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span><span class="params">()</span></span></div><div class="line"><span class="function">   </span>&#123;</div><div class="line">     <span class="keyword">$this</span>-&gt;app-&gt;singleton(Connection::class, <span class="function"><span class="keyword">function</span> <span class="params">($app)</span> </span>&#123;</div><div class="line">         <span class="keyword">return</span> <span class="keyword">new</span> Connection(config(<span class="string">'riak'</span>));</div><div class="line">     &#125;);</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个服务提供者仅仅只定义了一个 <code>register</code> 方法，并且使用这个方法在服务容器中定义了一个 <code>Riak\Connection</code> 的实现。如果你并不理解服务容器是如何工作的，你可以看一下服务容器的文档。</p>
<h3 id="启动方法"><a href="#启动方法" class="headerlink" title="启动方法"></a>启动方法</h3><p>如果我们想在服务提供者中注册一个视图 composer，那么我们应该在 <code>boot</code> 方法中做这些。<code>boot</code> 方法会在所有的服务提供者都注册完成之后才会被执行。这意味着你有访问所有服务的权限:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Providers</span>;</div><div class="line"></div><div class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Events</span>\<span class="title">Dispatcher</span> <span class="title">as</span> <span class="title">DispatcherContract</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Support</span>\<span class="title">Providers</span>\<span class="title">EventServiceProvider</span> <span class="title">as</span> <span class="title">ServiceProvider</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">  <span class="comment">// Other Service Provider Properties...</span></div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line"><span class="comment">   * Register any other events for your application.</span></div><div class="line"><span class="comment">   *</span></div><div class="line"><span class="comment">   * <span class="doctag">@param</span> \Illuminate\Contracts\Events\Dispatcher $events</span></div><div class="line"><span class="comment">   * <span class="doctag">@return</span> void</span></div><div class="line"><span class="comment">   */</span></div><div class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span><span class="params">(DispatcherContract $events)</span></span></div><div class="line"><span class="function">   </span>&#123;</div><div class="line">     <span class="keyword">parent</span>::boot($events);</div><div class="line"></div><div class="line">     view()-&gt;composer(<span class="string">'view'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">       <span class="comment">//</span></div><div class="line">     &#125;);</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="启动方法的依赖注入"><a href="#启动方法的依赖注入" class="headerlink" title="启动方法的依赖注入"></a>启动方法的依赖注入</h3><p>你可以在服务提供者的 <code>boot</code> 方法中使用类型提示来标识依赖。服务容器将会自动的将所需要的依赖注入进去：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Routing</span>\<span class="title">ResponseFactory</span>;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span><span class="params">(ResponseFactory $factory)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">  $factory-&gt;macro(<span class="string">'caps'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($value)</span>)</span>&#123;</div><div class="line">    <span class="comment">//</span></div><div class="line">  &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="注册提供者"><a href="#注册提供者" class="headerlink" title="注册提供者"></a>注册提供者</h2><p>所有的服务提供者都被注册在 <code>config/app.php</code> 配置文件中。这个文件包含了 <code>providers</code> 数组，这数组列出了所有服务提供者的名字。默认的，laravel 中的核心服务都被注册在这个数组里。这些提供者启动了 laravel 中的核心组件，如邮件，队列，缓存和其他。</p>
<p>你可以在该数组中进行添加注册提供者：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="string">'providers'</span> =&gt; [</div><div class="line">  <span class="comment">// Other Service Providers</span></div><div class="line"></div><div class="line">  App\Providers\AppServiceProvider::class,</div><div class="line">],</div></pre></td></tr></table></figure>
<h2 id="延迟加载提供者"><a href="#延迟加载提供者" class="headerlink" title="延迟加载提供者"></a>延迟加载提供者</h2><p>如果你的提供者只是在服务容器中注册一些绑定信息，那么你可以选择推迟注册，这样这些服务只有在真正被需要用到时才会进行注册。推迟注册能够提高你的应用的性能。因为它不会在所有请求到来时都通过文件系统来加载。</p>
<p>为了推迟提供者的加载，你可以在提供者类中设置 <code>defer</code> 属性为 <code>true</code> 并且定义一个 <code>provides</code> 方法。<code>provides</code> 方法会返回提供者注册的服务容器的绑定:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"></div><div class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Providers</span>;</div><div class="line"></div><div class="line"><span class="keyword">use</span> <span class="title">Riak</span>\<span class="title">Connection</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">ServiceProvider</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">RiakServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">  <span class="comment">/**</span></div><div class="line"><span class="comment">   * Indicates if loading of the provider is deferred.</span></div><div class="line"><span class="comment">   *</span></div><div class="line"><span class="comment">   * <span class="doctag">@var</span> bool</span></div><div class="line"><span class="comment">   */</span></div><div class="line">   <span class="keyword">protected</span> $defer = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">   <span class="comment">/**</span></div><div class="line"><span class="comment">    * Register the service provider.</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * <span class="doctag">@return</span> void</span></div><div class="line"><span class="comment">    */</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">      <span class="keyword">$this</span>-&gt;app-singleton(Connection::class, <span class="function"><span class="keyword">function</span> <span class="params">($app)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Connection($app[<span class="string">'config'</span>][<span class="string">'riak'</span>]);</div><div class="line">      &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * Get the services provided by the provider.</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></div><div class="line"><span class="comment">     */</span></div><div class="line">     <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">provides</span><span class="params">()</span></span></div><div class="line"><span class="function">     </span>&#123;</div><div class="line">        <span class="keyword">return</span> [Connection::class];</div><div class="line">     &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>laravel 会编译和存储所有延迟加载的服务提供者的服务列表及服务提供者的类名。然后，只有当你尝试解析其中的某个服务时，laravel 才会加载其服务提供者。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/15/laravel-from-scratch-application-structure/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dearmadman">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Team.dearmadman.com">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/15/laravel-from-scratch-application-structure/" itemprop="url">laravel 基础教程 —— 应用目录结构</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-05-15T15:58:54+08:00">
                2016-05-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>默认的 laravel 应用目录结构旨在为大型和小型应用提供一个很好的起点。当然你可以自主的去管理你的应用目录。Laravel 并没有限制类应该在哪里被构建，只要它能被 Composer 自动加载就行。</p>
<h2 id="根目录"><a href="#根目录" class="headerlink" title="根目录"></a>根目录</h2><p>新安装的 laravel 应用根目录中包含了各种子目录：</p>
<p><code>app</code> 目录，如你所预料的那样，这里包含了应用中的核心代码，我们将很快会探索这个目录。</p>
<p><code>bootstrap</code> 目录包含了一些文件去做整个框架的引导启动和配置自动加载，这个目录下还包含了为了提高应用的启动性能而自动生成的缓存文件存放的目录 <code>cache</code>。</p>
<p><code>config</code> 目录，如同名字所暗示的那样，这里包含了应用中各服务的配置文件。</p>
<p><code>database</code> 目录包含应用中所有的数据库迁移文件和种子文件，如果你需要，你也可以使用这个目录来存放 SQLite 数据库。</p>
<p><code>public</code> 目录包含了所有前端控制器和静态资源文件，比如图片，JavaScript，CSS,等等。</p>
<p><code>resources</code> 目录包含了所有的视图，原始资源文件（LESS,SASS,CoffeeScript)，和本土化文件。</p>
<p><code>storage</code> 目录包含了所有编译了的 Blade 模板，Session 文件，缓存文件和一些框架自动生成的其他文件。这个目录下分离出了 <code>app</code>,<code>framework</code> 和 <code>logs</code> 子目录。<code>app</code> 目录可以被用来存储任意对你应用有用的文件。<code>framework</code> 目录用来存储由框架生成的文件和缓存。最后，<code>logs</code> 目录包含了应用日志文件。</p>
<p><code>tests</code> 目录包含了所有自动化测试。这里已经提供了一个基于 PHPUnit 的测试用例。</p>
<p><code>vendor</code> 目录包含了所有 Composer 依赖</p>
<h2 id="App-目录"><a href="#App-目录" class="headerlink" title="App 目录"></a>App 目录</h2><p>应用的正餐都被存放在 <code>app</code> 目录中。默认的，该目录使用的是全局命名空间 <code>App</code>，并且通过 Composer 执行 PSR-4 自动加载规范进行自动加载。</p>
<p><code>app</code> 目录下包含多个子目录，如 <code>Console</code>、<code>Http</code>、<code>Providers</code> 等。 <code>Console</code> 和 <code>Http</code> 目录提供了进入应用核心的 API。HTTP 协议和 CLI 是两种均与应用进行交互的机制，但是它们实际上并不包含应用逻辑。就是说它们只是简单的向应用发布命令的两种方式。<code>Console</code> 目录包含了所有的 Artisan 命令，而 <code>Http</code> 目录包含了应用的控制器，中间件和请求。</p>
<p><code>Events</code> 目录，如你所料，这里存储事件类。事件可以被用来通知应用中其他部分给定的行为已经发生。它提供了灵活性和强大的解耦能力。</p>
<p><code>Exceptions</code> 目录包含了应用中所有的异常通知处理程序，这里是一个处理应用异常的好地方。</p>
<p><code>Jobs</code> 目录，当然，这里包含了所有的队列任务。应用中的任务可以被队列化或者也可以在当前请求周期内同步进行。</p>
<p><code>listeners</code> 目录包含了事件的处理器类，处理程序接收一个事件类并在事件触发时提供响应的逻辑。例如，<code>UserRegistered</code> 事件可以被 <code>SendWelcomeEmail</code> 监听器处理。</p>
<p><code>Policies</code> 目录包含了应用的授权策略类，策略类主要用来判断用户是否可以执行对资源的给定动作。</p>
<blockquote>
<p>注意：很多类在 <code>app</code> 目录中都可以通过 Artisan 命令来生成。你可以在终端中使用 <code>php artisan list make</code> 命令查看可用的命令。</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/15/laravel-from-scratch-request-lifecycle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dearmadman">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Team.dearmadman.com">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/15/laravel-from-scratch-request-lifecycle/" itemprop="url">laravel 基础教程 —— 请求生命周期</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-05-15T13:29:38+08:00">
                2016-05-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>在现实中，如果你明白了你所使用工具的工作原理，你就会在使用的时候非常的自信。开发应用并没有什么不同，当你弄懂了这些开发工具功能，你就会在使用时得心应手。</p>
<p>这份文档会深层次的带你浏览 laravel 框架是如何工作的。通过对框架更全面的了解，一切都会显得不再那么神秘，你会更加自信的去构建应用。</p>
<p>如果你并不能理解该文档的所有内容，请不要伤心。你需要先试着掌握一些基本的概念，你的知识体系会随着对文档的探索而增长。</p>
<h2 id="生命周期概述"><a href="#生命周期概述" class="headerlink" title="生命周期概述"></a>生命周期概述</h2><h3 id="第一件事"><a href="#第一件事" class="headerlink" title="第一件事"></a>第一件事</h3><p>laravel 应用中的所有请求的入口都是 <code>pulic/index.php</code> 文件，所有的请求都会被导向该文件。 <code>index.php</code> 文件中并没有存储太多的代码，相反，它只是用于装载框架的其余部分的起始点。</p>
<p><code>index.php</code> 文件会加载 Composer 生成的自动加载器配置信息，然后从 <code>bootstrap/app.php</code> 文件中加载 laravel 应用的实例，Laravel 的第一个动作就是创建一个服务容器的实例。</p>
<h3 id="HTTP-Console-内核"><a href="#HTTP-Console-内核" class="headerlink" title="HTTP / Console 内核"></a>HTTP / Console 内核</h3><p>根据请求进入应用程序的类型，请求将会被分配到 HTTP 内核 或 Console 内核处理。这两个内核都会作为所有请求流经过的中心处理器。现在，让我们只聚焦在 HTTP 内核上，它被存储在 <code>app/Http/Kernel.php</code> 文件中。</p>
<p>HTTP 内核继承自 <code>Illuminate\Foundation\Http\Kernel</code> 类，这个类定义了一个 <code>bootstrappers</code> 的数组，这些类会在请求被处理前运行。这些 <code>bootstrappers</code> 执行错误处理，日志，检测当前应用环境的配置和提供一些其它在请求被处理前执行的任务。</p>
<p>HTTP 内核也定义了一些 HTTP 中间件，所有请求在被处理前都会经过这些中间件。这些中间件包括了读写 HTTP Session 的中间件，判断当前站点是否是维护状态的中间件，验证 CSRF Token 的中间件，等等。</p>
<p>HTTP 内核的 <code>handle</code> 方法非常的简单：接收一个 <code>Request</code> 返回一个 <code>Response</code>。你可以把这个核心想象成一个黑盒子，左边 HTTP 请求进去，右边返回 HTTP 响应。</p>
<h3 id="服务提供者"><a href="#服务提供者" class="headerlink" title="服务提供者"></a>服务提供者</h3><p>启动内核中最重要的一步就是为你的应用加载服务提供者。所有的服务提供者都在 <code>config/app.php</code> 文件的 <code>providers</code> 数组中进行配置。首先，所有经过配置的提供者都会执行其自身的 <code>register</code> 方法，然后当所有提供者都完成注册之后，才会陆续的触发 <code>boot</code> 方法。</p>
<p>服务提供者主要负责启动框架中的各个组件，比如数据库组件、队列、验证和路由组件。因为框架中的各种核心功能都是从这里被提供的，所以服务提供者是整个框架启动中最重要的一环。</p>
<h3 id="分发请求"><a href="#分发请求" class="headerlink" title="分发请求"></a>分发请求</h3><p>一旦应用启动完成并且所有的服务提供者都完成注册，<code>Request</code> 将会移交到路由器进行分发。路由器将会分发该请求到路由或者控制器中，同时也会经过路由特定的中间件。</p>
<h2 id="聚焦服务提供者"><a href="#聚焦服务提供者" class="headerlink" title="聚焦服务提供者"></a>聚焦服务提供者</h2><p>服务提供者是 laravel 应用能够成功启动的最关键的部分。首先创建应用的实例，然后注册服务提供者，再然后处理已经启动成功应用的请求。整个请求流程就是这么简单。</p>
<p>能够深刻理解 laravel 是如何通过服务提供者进行启动和构建应用是非常有价值的。当然你的应用中默认的服务提供者都被存储在 <code>app/Providers</code> 目录中。</p>
<p>默认的，<code>AppServiceProvider</code> 是一个空的类，这里是你在应用中添加自己的启动项和做服务容器绑定的好去处。当然，在大型应用中，你可以自行的创建一些服务提供者，以使每一个提供者都具有单一的职责。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/14/laravel-from-scratch-blade/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dearmadman">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Team.dearmadman.com">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/14/laravel-from-scratch-blade/" itemprop="url">laravel 基础教程 —— Blade 模板引擎</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-05-14T20:46:27+08:00">
                2016-05-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Blade-模板引擎"><a href="#Blade-模板引擎" class="headerlink" title="Blade 模板引擎"></a>Blade 模板引擎</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Blade 是 laravel 提供的一个简单强大的模板引擎。它不像其他流行的 PHP 模板引擎那样限制你在视图中使用原生的 PHP 代码，事实上它就是把 Blade 视图编译成原生的 PHP 代码并缓存起来。缓存会在 Blade 视图改变时而改变，这意味着 Blade 并没有给你的应用添加编译的负担。Blade 视图文件使用 <code>.blade.php</code> 后缀，一般情况下都被存储在 <code>resources/views</code> 目录。</p>
<h2 id="模板继承"><a href="#模板继承" class="headerlink" title="模板继承"></a>模板继承</h2><h3 id="定义布局"><a href="#定义布局" class="headerlink" title="定义布局"></a>定义布局</h3><p>Blade 带来的两个主要的福利就是模板继承和挂件。为了方便开始，我们来看一个简单的例子。首先，我们建立一个主页面布局。因为多数 web 应用是在不同的页面中使用相同的总体布局，我们可以方便的定义这个布局为单独的 Blade 视图：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- Stored in resources/views/layouts/master.blade.php--&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>App Name - @yield('title')<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    @section('sidebar')</div><div class="line">      This is the master sidebar.</div><div class="line">    @show</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></div><div class="line">      @yield('content')</div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>从上面的例子你可以看到，Blade 模板文件包含了典型的 HTML 标记。你肯定注意到了 <code>@section</code> 和 <code>@yield</code> 指令。<code>@section</code> 指令就如它的名字所暗示的那样定义了一个内容区块，而 <code>@yield</code> 指令是用来显示所提供的挂件区块所包含的内容。</p>
<p>现在我们已经定义好了一个基本的布局，接下来我们来构建一个子页面去继承这个布局。</p>
<h3 id="扩展布局"><a href="#扩展布局" class="headerlink" title="扩展布局"></a>扩展布局</h3><p>我们可以使用 Blade 的 <code>@extends</code> 指令来明确的指定继承某个布局。然后使用 <code>@section</code> 指令将挂件中的内容挂载到布局中，在上面的例子中，挂件的内容将被挂载到布局中的 <code>@yield</code> 部分：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;!-- Stored in resoures/views/child.blade.php --&gt;</div><div class="line"></div><div class="line">@extends(<span class="string">'layouts.master'</span>)</div><div class="line"></div><div class="line">@section(<span class="string">'title'</span>, <span class="string">'Page Title'</span>)</div><div class="line"></div><div class="line">@section(<span class="string">'sidebar'</span>)</div><div class="line">  @<span class="keyword">parent</span></div><div class="line"></div><div class="line">  &lt;p&gt;This is appended to the master sidebar.&lt;/p&gt;</div><div class="line">@endsection</div><div class="line"></div><div class="line">@section(<span class="string">'content'</span>)</div><div class="line">  &lt;p&gt;This is my body content.&lt;/p&gt;</div><div class="line">@endsection</div></pre></td></tr></table></figure>
<p>在上面的例子作用 <code>sidebar</code> 挂件利用 <code>@parent</code> 指令来追加布局中的 sidebar 部分的内容，如果不使用则会覆盖掉布局中的这部分。<code>@parent</code> 指令会在视图被渲染时替换为布局中的内容。<br>Blade 视图可以像原生 PHP 视图一样使用全局帮助函数 <code>view</code> 来返回渲染后的内容：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Route::get(<span class="string">'blade'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">  <span class="keyword">return</span> view(<span class="string">'child'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h2 id="显示数据"><a href="#显示数据" class="headerlink" title="显示数据"></a>显示数据</h2><p>你可以使用花括号 <code>{</code> 来在视图中显示传递到视图中的变量，例如，你定义了下面的路由：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Route::get(<span class="string">'greeting'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">  <span class="keyword">return</span> view(<span class="string">'welcome'</span>, [<span class="string">'name'</span> =&gt; <span class="string">'Samantha'</span>]);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>你可以在视图中这样来输出 <code>name</code> 变量的内容：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Hello, &#123;&#123; $name &#125;&#125;</div></pre></td></tr></table></figure>
<p>当然，你并没有被限制只允许显示传递到视图中的变量的内容。你也可以从原生 PHP 方法中返回内容。事实上，你可以在 Blade echo 声明中使用任意的 PHP 代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">The current UNIX timestamp is &#123;&#123; time() &#125;&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>注意：Blade <code>{{}}</code> 声明中的内容是自动通过 PHP 的 <code>htmlentities</code> 方法过滤的，用来防止 XSS 攻击。</p>
</blockquote>
<h3 id="Blade-amp-JavaScript-Frameworks"><a href="#Blade-amp-JavaScript-Frameworks" class="headerlink" title="Blade &amp; JavaScript Frameworks"></a>Blade &amp; JavaScript Frameworks</h3><p>由于很多 JavaScript 框架都使用花括号来表明所提供的表达式应该被显示在浏览器中。所以你可以使用 <code>@</code> 符号来告诉 Blade 渲染引擎你需要这个表达式原样保留：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;h1&gt;Laravel&lt;/h1&gt;</div><div class="line"></div><div class="line">Hello, @&#123;&#123; name &#125;&#125;</div></pre></td></tr></table></figure>
<p>上面的例子中，<code>@</code> 符号会在 Blade 渲染时被移除，并且 <code></code> 表达式会被原样保留下来。</p>
<h3 id="输出数据假如它存在"><a href="#输出数据假如它存在" class="headerlink" title="输出数据假如它存在"></a>输出数据假如它存在</h3><p>有时候你可能希望输出一个变量，但是你并不确定它是否已经被设置，你可以使用这个表达式：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;&#123; <span class="keyword">isset</span>($name) ? $name : <span class="string">'Default'</span> &#125;&#125;</div></pre></td></tr></table></figure>
<p>Blade 提供了一个便捷的方式来替换这个三元声明：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;&#123; $name <span class="keyword">or</span> <span class="string">'Default'</span> &#125;&#125;</div></pre></td></tr></table></figure>
<p>上面的例子中，如果变量 <code>$name</code> 存在，它将被输入，如果不存在，<code>Default</code> 会被输出。</p>
<h3 id="显示未转义的数据"><a href="#显示未转义的数据" class="headerlink" title="显示未转义的数据"></a>显示未转义的数据</h3><p>默认的，Blade <code>{{}}</code> 声明会自动的使用 PHP 的 <code>htmlentities</code> 方法来避免 XSS 攻击。如果你不想你的数据被转义，你可以使用下面的语法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Hello, &#123;!! $name !!&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>注意：当你在应用中输出用户输入的数据时应该非常的谨慎，你应该总是使用 <code>{{}}</code> 来转义内容中任意的 HTML 实体。</p>
</blockquote>
<h2 id="控制结构"><a href="#控制结构" class="headerlink" title="控制结构"></a>控制结构</h2><p>除了模板继承和数据显示，Blade 为通用的 PHP 控制结构提供了便利的简写方式，比如条件声明和循环。这些简写提供了一个干净简洁的方式来处理 PHP 的控制结构，而且还保持与 PHP 语句的相似性。</p>
<h3 id="if-声明"><a href="#if-声明" class="headerlink" title="if 声明"></a>if 声明</h3><p>你可以通过 <code>@if</code>,<code>@elseif</code>,<code>@else</code>和 <code>@endif</code> 指令来使用 <code>if</code> 控制结构，这些指令和 PHP 方法保持一致:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">if</span> (count($records) === <span class="number">1</span>)</div><div class="line">  I have one record!</div><div class="line">@<span class="keyword">elseif</span> (count($records) &gt; <span class="number">1</span>)</div><div class="line">  I have multiple records!</div><div class="line">@<span class="keyword">else</span></div><div class="line">  I don<span class="string">'t have any records!</span></div><div class="line"><span class="string">@endif</span></div></pre></td></tr></table></figure>
<p>为了方便，Blade 也提供了 <code>@unless</code> 指令：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">@unless (Auth::check())</div><div class="line">  You are not signed in.</div><div class="line">@endunless</div></pre></td></tr></table></figure>
<p>你也可以使用 <code>@hasSection</code> 指令来判断提供给布局的挂件是否包含了内容:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;title&gt;</div><div class="line">  @hasSection(<span class="string">'title'</span>)</div><div class="line">    @<span class="keyword">yield</span>(<span class="string">'title'</span>) - App Name</div><div class="line">  @<span class="keyword">else</span></div><div class="line">    App Name</div><div class="line">  @<span class="keyword">endif</span></div><div class="line">&lt;/title&gt;</div></pre></td></tr></table></figure>
<h3 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h3><p>除了条件声明，Blade 也提供了一些简单指令来支持 PHP 的循环结构。这些指令方法和 PHP 语法相同：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; <span class="number">10</span>; $i++)</div><div class="line">  The current value is &#123;&#123; $i &#125;&#125;</div><div class="line">@<span class="keyword">endfor</span></div><div class="line"></div><div class="line">@<span class="keyword">foreach</span> ($users <span class="keyword">as</span> $user)</div><div class="line">  &lt;p&gt;This is user &#123;&#123; $user-&gt;id &#125;&#125;&lt;/p&gt;</div><div class="line">@<span class="keyword">endforeach</span></div><div class="line"></div><div class="line">@forelse ($users <span class="keyword">as</span> $user)</div><div class="line">  &lt;li&gt;&#123;&#123; $user-&gt;name &#125;&#125;&lt;/li&gt;</div><div class="line">@<span class="keyword">empty</span></div><div class="line">  &lt;p&gt;No users&lt;/p&gt;</div><div class="line">@endforelse</div><div class="line"></div><div class="line">@<span class="keyword">while</span> (<span class="keyword">true</span>)</div><div class="line">  &lt;p&gt;I<span class="string">'m looping forever.&lt;/p&gt;</span></div><div class="line"><span class="string">@endwhile</span></div></pre></td></tr></table></figure>
<p>Blade 也提供了终止迭代或取消当前迭代的指令：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">foreach</span> ($users <span class="keyword">as</span> $user)</div><div class="line">  @<span class="keyword">if</span>($user-&gt;type == <span class="number">1</span>)</div><div class="line">    @<span class="keyword">continue</span></div><div class="line">  @<span class="keyword">endif</span></div><div class="line"></div><div class="line">  &lt;li&gt;&#123;&#123; $user-&gt;name &#125;&#125;&lt;/li&gt;</div><div class="line"></div><div class="line">  @<span class="keyword">if</span>($user-&gt;number == <span class="number">5</span>)</div><div class="line">    @<span class="keyword">break</span></div><div class="line">  @<span class="keyword">endif</span></div><div class="line">@<span class="keyword">endforeach</span></div></pre></td></tr></table></figure>
<p>你也可以使用指令声明包含条件的方式来达到中断:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">foreach</span> ($users <span class="keyword">as</span> $user)</div><div class="line">  @<span class="keyword">continue</span>($user-&gt;type == <span class="number">1</span>)</div><div class="line"></div><div class="line">  &lt;li&gt;&#123;&#123; $user-&gt;name &#125;&#125;&lt;/li&gt;</div><div class="line"></div><div class="line">  @<span class="keyword">break</span>($user-&gt;number == <span class="number">5</span>)</div><div class="line">@<span class="keyword">endforeach</span></div></pre></td></tr></table></figure>
<h3 id="包含子视图"><a href="#包含子视图" class="headerlink" title="包含子视图"></a>包含子视图</h3><p>你可以使用 <code>@include</code> 指令来包含一个视图的内容，当前视图中的变量也会被共享给子视图：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;div&gt;</div><div class="line">  @<span class="keyword">include</span>(<span class="string">'shared.errors'</span>)</div><div class="line"></div><div class="line">  &lt;form&gt;</div><div class="line">  &lt;!-- Form Contents --&gt;</div><div class="line">  &lt;/form&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<p>尽管子视图会自动继承父视图中的所有数据变量，你也可以直接传递一个数组变量来添加额外的变量到子视图：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@<span class="keyword">include</span>(<span class="string">'view.name'</span>, [<span class="string">'some'</span> =&gt; <span class="string">'data'</span>])</div></pre></td></tr></table></figure>
<blockquote>
<p>主要：你应该在 Blade 视图中避免使用 <code>__DIR__</code> 和 <code>__FILE__</code> 常量，因为它们会解析为视图缓存所在的位置。</p>
</blockquote>
<h3 id="为集合渲染视图"><a href="#为集合渲染视图" class="headerlink" title="为集合渲染视图"></a>为集合渲染视图</h3><p>你可以使用 Blade 的 <code>@each</code> 指令来在一行中合并引入多个视图:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@each(<span class="string">'view.name'</span>, $jobs, <span class="string">'job'</span>)</div></pre></td></tr></table></figure>
<p>第一个参数是数组或集合中每个元素需要被渲染的视图名称。第二个参数是一个数组或集合，被用来提供迭代。而第三个参数是要分配给当前视图的变量名。举个例子，如果你需要遍历一个数组 <code>jobs</code>，通常你想要在局部渲染的视图中使用 <code>job</code> 作为变量来访问 job 信息。</p>
<p>你也可以传递第四个参数到 <code>@each</code> 指令。如果所提供的数组是空数组的话，该参数所提供的视图将会被引入。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@each(<span class="string">'view.name'</span>, $jobs, <span class="string">'job'</span>, <span class="string">'view.empty'</span>)</div></pre></td></tr></table></figure>
<h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><p>Blade 也允许你在视图中定义注释，但是它不会在渲染时生成 HTML 注释：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;&#123;-- This comment will not be present in the rendered HTML --&#125;&#125;</div></pre></td></tr></table></figure>
<h2 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h2><p>Blade 允许你在已命名的堆中压入内容：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">@push(<span class="string">'scripts'</span>)</div><div class="line">  &lt;script src=<span class="string">"/example.js"</span>&gt;&lt;/script&gt;</div><div class="line">@endpush</div></pre></td></tr></table></figure>
<p>你可以在你需要的时候压入相同的堆任意的次数,你需要在布局中使用 <code>@stack</code> 来渲染堆:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;head&gt;</div><div class="line">  &lt;!-- Head Contents --&gt;</div><div class="line"></div><div class="line">  @stack(<span class="string">'scripts'</span>)</div><div class="line">&lt;/head&gt;</div></pre></td></tr></table></figure>
<h2 id="服务注入"><a href="#服务注入" class="headerlink" title="服务注入"></a>服务注入</h2><p>你可以使用 <code>@inject</code> 指令来从服务容器中取回服务，该指令的第一个参数将作为所取回服务存放的变量名，而第二个参数是你想要在服务容器中取回的类或接口名称：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@inject(<span class="string">'metrics'</span>, <span class="string">'App\Services\MetricsService'</span>)</div><div class="line"></div><div class="line">&lt;div&gt;</div><div class="line">  Monthly Revenue: &#123;&#123; $metrice-&gt;monthlyRevenue() &#125;&#125;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<h2 id="扩展-Blade"><a href="#扩展-Blade" class="headerlink" title="扩展 Blade"></a>扩展 Blade</h2><p>Blade 允许你自定义一些指令，你可以使用 <code>directvie</code> 方法来注册指令。当 Blade 编译器遇到该指令时，它会自动的调用该指令注册时提供的回调函数并传递它的参数。</p>
<p>下面的例子创建了 <code>@datetime($val)</code> 指令来格式化 <code>$val</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Providers</span>;</div><div class="line"></div><div class="line"><span class="keyword">use</span> <span class="title">Blade</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">ServiceProvider</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">  <span class="comment">/**</span></div><div class="line"><span class="comment">   * Perform post-registration booting of services.</span></div><div class="line"><span class="comment">   *</span></div><div class="line"><span class="comment">   * <span class="doctag">@return</span> void</span></div><div class="line"><span class="comment">   */</span></div><div class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span><span class="params">()</span></span></div><div class="line"><span class="function">   </span>&#123;</div><div class="line">     Blade::directive(<span class="string">'datetime'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($expression)</span> </span>&#123;</div><div class="line">       <span class="keyword">return</span> <span class="string">"&lt;?php echo with&#123;$express&#125;-&gt;format('m/d/Y H:i'); ?&gt;"</span>;</div><div class="line">     &#125;);</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="comment">/**</span></div><div class="line"><span class="comment">    * Register bindings in the container</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * <span class="doctag">@return</span> void</span></div><div class="line"><span class="comment">    */</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">      <span class="comment">//</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面的例子中使用了 Laravel 的 <code>with</code> 帮助方法，它只是简单的返回一个所提供的对象或值，并提供方便的链式调用。最终该指令生成的 PHP 代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> with($var)-&gt;format(<span class="string">'m/d/Y H:i'</span>); <span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<p>在你更新 Blade 指令的逻辑之后，你应该删除所有已缓存的 Blade 视图，你可以使用 <code>view:clear</code> Artisan 命令来清除。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/14/laravel-from-scratch-view/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dearmadman">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Team.dearmadman.com">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/14/laravel-from-scratch-view/" itemprop="url">laravel 基础教程 —— 视图</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-05-14T10:09:03+08:00">
                2016-05-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h1><p>视图为表现逻辑与应用逻辑的分离提供了便利，laravel 中所有的视图都被存储在 <code>resources/views</code> 目录下。</p>
<h2 id="基础用法"><a href="#基础用法" class="headerlink" title="基础用法"></a>基础用法</h2><p>一个简单的视图看起来是这样的:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- View stored in resources/views/greeting.php --&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, <span class="php"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> $name; <span class="meta">?&gt;</span></span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>我们可以使用全局的帮助函数 <code>view</code> 来返回视图 <code>resources/views/greeting.php</code> 的渲染的结果：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Route::get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">  <span class="keyword">return</span> view(<span class="string">'greeting'</span>, [<span class="string">'name'</span> =&gt; <span class="string">'James'</span>]);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>你可以看到，<code>view</code> 方法接收的第一个参数是相对于目录 <code>resources/views</code> 的文件名。该方法也允许传递数组作为第二个参数，数组中的键值对会作为相应的变量传递到视图。上面的例子中就会输出 <code>Hello, James</code></p>
<h3 id="假如视图存在"><a href="#假如视图存在" class="headerlink" title="假如视图存在"></a>假如视图存在</h3><p>如果你需要判断视图是否存在，那么你可以使用 <code>exists</code> 方法来进行验证，你可以通过使用无参数的全局帮助函数 <code>view()</code> 来进行链式操作，如果视图存在则会返回 <code>true</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (view()-&gt;exists(<span class="string">'email.customer'</span>)) &#123;</div><div class="line">  <span class="comment">// </span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>当调用 <code>view</code> 方法而不传递任何参数时，会返回一个 <code>Illuminate\Contracts\View\Factory</code> 的实例，你可以访问该契约的任何方法。</p>
<h2 id="视图数据"><a href="#视图数据" class="headerlink" title="视图数据"></a>视图数据</h2><h3 id="传递数据到视图"><a href="#传递数据到视图" class="headerlink" title="传递数据到视图"></a>传递数据到视图</h3><p>从上面的例子你就可以看出，你可以非常方便的使用一个数组作为数据来传递到视图：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">return</span> view(<span class="string">'greetings'</span>, [<span class="string">'name'</span> =&gt; <span class="string">'Victoria'</span>]);</div></pre></td></tr></table></figure>
<p>使用这种方法传递数据，<code>$data</code> 必须应该是键值对的形式，在视图中，你可以使用相应的‘键’来访问相应的数值。当然你可以使用 <code>with</code> 方法来传递额外的数据：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">return</span> view(<span class="string">'greetings'</span>)-&gt;with(<span class="string">'name'</span>, <span class="string">'Victoria'</span>);</div></pre></td></tr></table></figure>
<h3 id="共享数据到所有视图"><a href="#共享数据到所有视图" class="headerlink" title="共享数据到所有视图"></a>共享数据到所有视图</h3><p>有时候，你可能需要共享一部分数据到所有的视图中，你可以使用视图工厂方法 <code>share</code> 来做到这件事情。通常情况下，你应该是在服务容器中的 <code>boot</code> 方法中去做数据共享操作。你可以在 <code>AppServiceProvider</code> 或者 独立生成一个分离的服务提供者来做这件事：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Providers</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">  <span class="comment">/**</span></div><div class="line"><span class="comment">   * Bootstrap any application services.</span></div><div class="line"><span class="comment">   *</span></div><div class="line"><span class="comment">   * <span class="doctag">@return</span> void</span></div><div class="line"><span class="comment">   */</span></div><div class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span><span class="params">()</span></span></div><div class="line"><span class="function">   </span>&#123;</div><div class="line">      view()-&gt;share(<span class="string">'key'</span>, <span class="string">'value'</span>);</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="comment">/**</span></div><div class="line"><span class="comment">    * Register the service provider.</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * <span class="doctag">@return</span> void</span></div><div class="line"><span class="comment">    */</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">      <span class="comment">//</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="视图-Composers"><a href="#视图-Composers" class="headerlink" title="视图 Composers"></a>视图 Composers</h2><p>视图 composers （演奏者）就是当视图被渲染时会被触发的回调方法或者类的方法。如果你想要视图在每次被渲染时都自动的绑定一些数据到视图，那么视图 composer 就可以分离这些逻辑处理。</p>
<p>那么现在让我们在服务提供者中注册我们自己的视图 composers。我们将使用 <code>view</code> 帮助方法来返回一个 <code>Illuminate\Contracts\View\Factory</code> 契约的实现实例。laravel 中并没有提供一个默认的目录去管理这些视图 composers，你可以自主的按照自己的喜欢去管理这些，你当然也可以创建一个 <code>App\Http\ViewComposers</code> 目录：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Providers</span>;</div><div class="line"></div><div class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">ServiceProvider</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ComposerServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">  <span class="comment">/**</span></div><div class="line"><span class="comment">   * Register bindings in the container.</span></div><div class="line"><span class="comment">   *</span></div><div class="line"><span class="comment">   * <span class="doctag">@return</span> void</span></div><div class="line"><span class="comment">   */</span></div><div class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span><span class="params">()</span></span></div><div class="line"><span class="function">   </span>&#123;</div><div class="line">      <span class="comment">// Using class based composers...</span></div><div class="line">      view()-&gt;composer(</div><div class="line">        <span class="string">'profile'</span>, <span class="string">'App\Http\ViewComposers\ProfileComposer'</span></div><div class="line">      );</div><div class="line"></div><div class="line">      <span class="comment">// Using Closure based composers...</span></div><div class="line">      view()-&gt;composer(<span class="string">'dashboard'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($view)</span></span>&#123;</div><div class="line">        <span class="comment">//</span></div><div class="line">      &#125;);</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="comment">/**</span></div><div class="line"><span class="comment">    * Register the service provider.</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * <span class="doctag">@return</span> void</span></div><div class="line"><span class="comment">    */</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">      <span class="comment">//</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果你创建了一个服务提供者来包含你所有的视图 composers 注册，你千万不要忘记在 <code>config/app.php</code> 文件中的 <code>providers</code> 数组中进行追加注册该提供者。</p>
<p>现在我们有了已经注册了的 composer，方法 <code>ProfileComposer@compose</code> 将在视图 <code>profile</code> 每次被渲染时自动执行。接着，我们来定义 <code>ProfileComposer</code> 类：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">ViewComposers</span>;</div><div class="line"></div><div class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">View</span>\<span class="title">View</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Repositories</span>\<span class="title">UserRepository</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProfileCompoer</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">  <span class="comment">/**</span></div><div class="line"><span class="comment">   * The user repository implementation.</span></div><div class="line"><span class="comment">   *</span></div><div class="line"><span class="comment">   * <span class="doctag">@var</span> UserRepository</span></div><div class="line"><span class="comment">   */</span></div><div class="line">   <span class="keyword">protected</span> $users;</div><div class="line"></div><div class="line">   <span class="comment">/**</span></div><div class="line"><span class="comment">    * Create a new profile composer.</span></div><div class="line"><span class="comment">    *</span></div><div class="line"><span class="comment">    * <span class="doctag">@param</span> UserRepository $users</span></div><div class="line"><span class="comment">    * <span class="doctag">@return</span> void</span></div><div class="line"><span class="comment">    */</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(UserRepository $users)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">      <span class="comment">// Dependencies automatically resolved by service container...</span></div><div class="line">      <span class="keyword">$this</span>-&gt;users = $users;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * Bind data to the view.</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> View $view</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></div><div class="line"><span class="comment">     */</span></div><div class="line">     <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">compose</span><span class="params">(View $view)</span></span></div><div class="line"><span class="function">     </span>&#123;</div><div class="line">       $view-&gt;with(<span class="string">'count'</span>, <span class="keyword">$this</span>-&gt;users-&gt;count());</div><div class="line">     &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>每当视图被渲染之前，composer 的 <code>compose</code> 方法都会被调用，并且会传递一个 <code>Illuminate\View\View</code> 的实例，你可以使用 <code>with</code> 方法添加额外的数据到视图。</p>
<blockquote>
<p>注意：所有的视图 composer 都是通过服务容器被解析的，所以你可以在 composer 的构造函数中添加类型提示信息来进行任意的依赖注入。</p>
</blockquote>
<h3 id="附加-composer-到多个视图"><a href="#附加-composer-到多个视图" class="headerlink" title="附加 composer 到多个视图"></a>附加 composer 到多个视图</h3><p>你可以一次性的绑定一个 composer 到多个视图，你只需要简单的在 <code>composer</code> 方法中的第一个参数传递一个包含视图名称的数组:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">view()-&gt;composer(</div><div class="line">  [<span class="string">'profile'</span>, <span class="string">'dashboard'</span>],</div><div class="line">  <span class="string">'App\Http\ViewComposers\MyViewComposer'</span></div><div class="line">);</div></pre></td></tr></table></figure>
<p>事实上 <code>composer</code> 方法也接受 <code>*</code> 字符作为通配符，允许你附加 composer 到所有的视图中:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">view()-&gt;composer(<span class="string">'*'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($view)</span> </span>&#123;</div><div class="line">  <span class="comment">// </span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="视图创造者"><a href="#视图创造者" class="headerlink" title="视图创造者"></a>视图创造者</h3><p>视图创造者和视图 composer 类似，只不过它是在视图实例化后就立即触发注册的方法，而不是等到视图渲染时。你可以使用 <code>creator</code> 方法来注册视图创造者：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">view()-&gt;creator(<span class="string">'profile'</span>, <span class="string">'App\Http\ViewCreators\ProfileCreator'</span>);</div></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/09/javascript-standard-style/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dearmadman">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Team.dearmadman.com">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/09/javascript-standard-style/" itemprop="url">JavaScript Standard Style</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-05-09T10:50:28+08:00">
                2016-05-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Javascript-Standard-Style"><a href="#Javascript-Standard-Style" class="headerlink" title="Javascript Standard Style"></a>Javascript Standard Style</h1><p>这是一个标准的 JavaScript 书写规范。</p>
<h2 id="规范"><a href="#规范" class="headerlink" title="规范"></a>规范</h2><h3 id="使用-2-个空格进行缩进"><a href="#使用-2-个空格进行缩进" class="headerlink" title="使用 2 个空格进行缩进"></a>使用 2 个空格进行缩进</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello</span> (<span class="params">name</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'hi'</span>, name)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="使用单引号包裹字符串以防止转义"><a href="#使用单引号包裹字符串以防止转义" class="headerlink" title="使用单引号包裹字符串以防止转义"></a>使用单引号包裹字符串以防止转义</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(<span class="string">'hello there'</span>)</div><div class="line">$(<span class="string">"&lt;div class='box'&gt;"</span>)</div></pre></td></tr></table></figure>
<h3 id="不定义未使用的变量"><a href="#不定义未使用的变量" class="headerlink" title="不定义未使用的变量"></a>不定义未使用的变量</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFunction</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> result = something()    <span class="comment">// avoid</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="在关键字后应追加一个空格"><a href="#在关键字后应追加一个空格" class="headerlink" title="在关键字后应追加一个空格"></a>在关键字后应追加一个空格</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (condition) &#123; ... &#125;    <span class="comment">// ok</span></div><div class="line"><span class="keyword">if</span>(condition) &#123; ... &#125;     <span class="comment">// avoid</span></div></pre></td></tr></table></figure>
<h3 id="在函数声明的括号前追加一个空格"><a href="#在函数声明的括号前追加一个空格" class="headerlink" title="在函数声明的括号前追加一个空格"></a>在函数声明的括号前追加一个空格</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">name</span> (<span class="params">arg</span>) </span>&#123; ... &#125;     <span class="comment">// ok</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">name</span>(<span class="params">arg</span>) </span>&#123; ... &#125;      <span class="comment">// avoid</span></div><div class="line"></div><div class="line">run(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; ... &#125;)        <span class="comment">// ok</span></div><div class="line">run(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; ... &#125;)         <span class="comment">// avoid</span></div></pre></td></tr></table></figure>
<h3 id="应始终使用-来代替"><a href="#应始终使用-来代替" class="headerlink" title="应始终使用 === 来代替 =="></a>应始终使用 <code>===</code> 来代替 <code>==</code></h3><p>例外： <code>obj == null</code> 允许使用 <code>==</code> 来判断 <code>null || undefined</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (name === <span class="string">'John'</span>)      <span class="comment">// ok</span></div><div class="line"><span class="keyword">if</span> (name == <span class="string">'John'</span>)       <span class="comment">// avoid</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> (name !== <span class="string">'John'</span>)      <span class="comment">// ok</span></div><div class="line"><span class="keyword">if</span> (name != <span class="string">'John'</span>)       <span class="comment">// avoid</span></div></pre></td></tr></table></figure>
<h3 id="操作符前后应有空格"><a href="#操作符前后应有空格" class="headerlink" title="操作符前后应有空格"></a>操作符前后应有空格</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ok</span></div><div class="line"><span class="keyword">var</span> x = <span class="number">2</span></div><div class="line"><span class="keyword">var</span> message = <span class="string">'hello, '</span> + name + <span class="string">'!'</span></div><div class="line"></div><div class="line"><span class="comment">// avoid</span></div><div class="line"><span class="keyword">var</span> x=<span class="number">2</span></div><div class="line"><span class="keyword">var</span> message = <span class="string">'hello, '</span>+name+<span class="string">'!'</span></div></pre></td></tr></table></figure>
<h3 id="逗号后应该追加一个空格"><a href="#逗号后应该追加一个空格" class="headerlink" title="逗号后应该追加一个空格"></a>逗号后应该追加一个空格</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ok</span></div><div class="line"><span class="keyword">var</span> list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">greet</span> (<span class="params">name, options</span>) </span>&#123; ... &#125;</div><div class="line"></div><div class="line"><span class="comment">// avoid</span></div><div class="line"><span class="keyword">var</span> list = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">greet</span> (<span class="params">name,options</span>) </span>&#123; ... &#125;</div></pre></td></tr></table></figure>
<h3 id="使-else-声明和其大括号保持在同一行"><a href="#使-else-声明和其大括号保持在同一行" class="headerlink" title="使 else 声明和其大括号保持在同一行"></a>使 else 声明和其大括号保持在同一行</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ok</span></div><div class="line"><span class="keyword">if</span> (condition) &#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// avoid</span></div><div class="line"><span class="keyword">if</span> (condition) &#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">else</span> &#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="对于多行的-if-语句，应使用大括号"><a href="#对于多行的-if-语句，应使用大括号" class="headerlink" title="对于多行的 if 语句，应使用大括号"></a>对于多行的 if 语句，应使用大括号</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ok</span></div><div class="line"><span class="keyword">if</span> (options.quiet !== <span class="literal">true</span>) <span class="built_in">console</span>.log(<span class="string">'done'</span>)</div><div class="line"></div><div class="line"><span class="comment">// ok</span></div><div class="line"><span class="keyword">if</span> (options.quiet !== <span class="literal">true</span>) &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'done'</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// avoid</span></div><div class="line"><span class="keyword">if</span> (option.quiet !== <span class="literal">true</span>)</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'done'</span>)</div></pre></td></tr></table></figure>
<h3 id="总是处理函数中的-err-参数"><a href="#总是处理函数中的-err-参数" class="headerlink" title="总是处理函数中的 err 参数"></a>总是处理函数中的 err 参数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ok</span></div><div class="line">run(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</div><div class="line">  <span class="built_in">window</span>.alert(<span class="string">'done'</span>)</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">// avoid</span></div><div class="line">run(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</div><div class="line">  <span class="built_in">window</span>.alert(<span class="string">'done'</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="对于浏览器全局变量应始终使用-window-前缀"><a href="#对于浏览器全局变量应始终使用-window-前缀" class="headerlink" title="对于浏览器全局变量应始终使用 window. 前缀"></a>对于浏览器全局变量应始终使用 <code>window.</code> 前缀</h3><p>例外： <code>document</code>，<code>console</code> 和 <code>navigator</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.alert(<span class="string">'hi'</span>)</div></pre></td></tr></table></figure>
<h3 id="不允许存在多行空行"><a href="#不允许存在多行空行" class="headerlink" title="不允许存在多行空行"></a>不允许存在多行空行</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ok</span></div><div class="line"><span class="keyword">var</span> value = <span class="string">'hello world'</span></div><div class="line"><span class="built_in">console</span>.log(value)</div><div class="line"></div><div class="line"><span class="comment">// avoid</span></div><div class="line"><span class="keyword">var</span> value = <span class="string">'hello world'</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(value)</div></pre></td></tr></table></figure>
<h3 id="对于多行的三元运算，应将-和-独立一行"><a href="#对于多行的三元运算，应将-和-独立一行" class="headerlink" title="对于多行的三元运算，应将 ? 和 : 独立一行"></a>对于多行的三元运算，应将 <code>?</code> 和 <code>:</code> 独立一行</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ok</span></div><div class="line"><span class="keyword">var</span> location = env.development ? <span class="string">'localhost'</span> : <span class="string">'www.api.com'</span></div><div class="line"></div><div class="line"><span class="comment">// ok</span></div><div class="line"><span class="keyword">var</span> location = env.development</div><div class="line">  ? <span class="string">'localhost'</span></div><div class="line">  : <span class="string">'www.api.com'</span></div><div class="line"></div><div class="line"><span class="comment">// avoid</span></div><div class="line"><span class="keyword">var</span> location = env.development ?</div><div class="line">  <span class="string">'localhost'</span> :</div><div class="line">  <span class="string">'www.api.com'</span></div></pre></td></tr></table></figure>
<h3 id="对于-var-声明，每个变量应该进行独立声明"><a href="#对于-var-声明，每个变量应该进行独立声明" class="headerlink" title="对于 var 声明，每个变量应该进行独立声明"></a>对于 var 声明，每个变量应该进行独立声明</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ok</span></div><div class="line"><span class="keyword">var</span> silent = <span class="literal">true</span></div><div class="line"><span class="keyword">var</span> verbose = <span class="literal">true</span></div><div class="line"></div><div class="line"><span class="comment">// avoid</span></div><div class="line"><span class="keyword">var</span> silent = <span class="literal">true</span>, verbose = <span class="literal">true</span></div><div class="line"></div><div class="line"><span class="comment">// avoid</span></div><div class="line"><span class="keyword">var</span> silent = <span class="literal">true</span>,</div><div class="line">    verbose = <span class="literal">true</span></div></pre></td></tr></table></figure>
<h3 id="在条件判断的表达式中，应使用括号包裹赋值语句"><a href="#在条件判断的表达式中，应使用括号包裹赋值语句" class="headerlink" title="在条件判断的表达式中，应使用括号包裹赋值语句"></a>在条件判断的表达式中，应使用括号包裹赋值语句</h3><p>这样明确的表示是故意使用 <code>=</code> 赋值，而非 <code>===</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ok</span></div><div class="line"><span class="keyword">while</span> ((m = text.match(expr))) &#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// avoid</span></div><div class="line"><span class="keyword">while</span> (m = text.match(expr)) &#123;</div><div class="line">  <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="分号"><a href="#分号" class="headerlink" title="分号"></a>分号</h2><h3 id="不允许使用分号"><a href="#不允许使用分号" class="headerlink" title="不允许使用分号"></a>不允许使用分号</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.alert(<span class="string">'hi'</span>)      <span class="comment">// ok</span></div><div class="line"><span class="built_in">window</span>.alert(<span class="string">'hi'</span>);     <span class="comment">// avoid</span></div></pre></td></tr></table></figure>
<h3 id="永远不使用-、-、-作为一行的开头"><a href="#永远不使用-、-、-作为一行的开头" class="headerlink" title="永远不使用 (、[、` 作为一行的开头"></a>永远不使用 <strong>(</strong>、<strong>[</strong>、<strong>`</strong> 作为一行的开头</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ok</span></div><div class="line">;(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">window</span>.alert(<span class="string">'ok'</span>)</div><div class="line">&#125;())</div><div class="line"></div><div class="line"><span class="comment">// avoid</span></div><div class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">window</span>.alert(<span class="string">'ok'</span>)</div><div class="line">&#125;())</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// ok</span></div><div class="line">;[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].forEach(bar)</div><div class="line"></div><div class="line"><span class="comment">// avoid</span></div><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].forEach(bar)</div><div class="line"></div><div class="line"><span class="comment">// ok</span></div><div class="line">;<span class="string">`hello`</span>.indexOf(<span class="string">'o'</span>)</div><div class="line"></div><div class="line"><span class="comment">// avoid</span></div><div class="line"><span class="string">`hello`</span>.indexOf(<span class="string">'o'</span>)</div></pre></td></tr></table></figure>
<p>对于这种表达式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">;[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].forEach(bar)</div></pre></td></tr></table></figure>
<p>可以这么替代:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</div><div class="line">nums.forEach(bar)</div></pre></td></tr></table></figure>
<p>参考： <a href="https://github.com/feross/standard/blob/master/RULES.md" target="_blank" rel="external">JavaScript Standrad Style</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/07/the-PSR-7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dearmadman">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Team.dearmadman.com">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/07/the-PSR-7/" itemprop="url">the PSR-7</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-05-07T17:21:51+08:00">
                2016-05-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/07/the-PSR-6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dearmadman">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Team.dearmadman.com">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/05/07/the-PSR-6/" itemprop="url">PSR 规范 —— PSR-6</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-05-07T17:21:41+08:00">
                2016-05-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="PHP-Standard-Recommendations"><a href="#PHP-Standard-Recommendations" class="headerlink" title="PHP Standard Recommendations"></a>PHP Standard Recommendations</h1><blockquote>
<p>PSR 是 PHP Standard Recommendations 的简写，它是由 <a href="https://github.com/php-fig" target="_blank" rel="external">PHP FIG</a> 组织制定的 PHP 规范，是 PHP 开发的实践标准。</p>
</blockquote>
<h2 id="序号-6：缓存接口规范"><a href="#序号-6：缓存接口规范" class="headerlink" title="序号 6：缓存接口规范"></a>序号 6：缓存接口规范</h2><p>缓存是提升应用性能的常用手段，为框架中最通用的功能，每个框架也都推出专属的、功能多样的缓存库。这些差别使得开发人员不得不学习多种系统，而很多可能是他们并不需要的功能。此外，缓存库的开发者同样面临着一个窘境，是只支持有限数量的几个框架还是创建一堆庞大的适配器类。<br>一个通用的缓存系统接口可以解决掉这些问题。库和框架的开发人员能够知道缓存系统会按照他们所预期的方式工作，缓存系统的开发人员只需要实现单一的接口，而不用去开发各种各样的适配器。</p>
<h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><p>本 PSR 的目标是：创建一套通用的接口规范，能够让开发人员整合到现有框架和系统，而不需要去开发框架专属的适配器类。</p>
<h3 id="关于“能愿动词”的使用"><a href="#关于“能愿动词”的使用" class="headerlink" title="关于“能愿动词”的使用"></a>关于“能愿动词”的使用</h3><p>为了避免歧义，文档大量使用了“能愿动词”，对应的解释如下：</p>
<ul>
<li><code>必须（MUST）</code>：绝对，严格遵循，请照做，无条件遵守；</li>
<li><code>一定不可（MUST NOT）</code>：禁令，严令禁止；</li>
<li><code>应该（SHOULD）</code>：强烈建议这样做，但是不强求；</li>
<li><code>不该（SHOULD NOT）</code>：强烈不建议这样做，但是不强求；</li>
<li><code>可以（MAY）</code> 和 <code>可选（OPTIONAL）</code>：选择性高一点，在这个文档内，此词语使用较少；</li>
</ul>
<blockquote>
<p>参见：<a href="http://www.ietf.org/rfc/rfc2119.txt" target="_blank" rel="external">RFC 2119</a></p>
</blockquote>
<h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><ul>
<li><strong>调用类库（Calling Library）</strong>- 调用者，使用缓存服务的类库，这个类库调用缓存服务，调用的是此缓存接口规范的具体‘实现类库’，调用者不需要知道任何‘缓存服务’的具体实现。</li>
<li><strong>实现类库（Implementing Library）</strong> - 此类库是对‘缓存接口规范’的具体实现，封装起来的缓存服务，供’调用类库’。实现类库 <strong>必须</strong> 提供 PHP 类来实现 <code>Cache\CacheItemPoolInterface</code> 和 <code>Cache\CacheItemInterface</code> 接口。实现类库 <strong>必须</strong> 支持最小的如下描述的 TTL 功能，秒级别的精准度。</li>
<li>生存时间（TTL - Time To Live）- 定义了缓存可以存活的时间，以秒为单位的整数值。</li>
<li>过期时间（Expiration）- 定义准确的过期时间点，一般为缓存存储发生的时间点加上 TTL 时间值，也可以指定一个 DateTime 对象。<br>假如一个缓存项的 TTL 设置为 300 秒，保存于 1:30:00，那么缓存项的过期时间为 1:35:00。<br>实现类库 <strong>可以</strong> 让缓存项提前过期，但是 <strong>必须</strong> 在到达过期时间时立即把缓存项标示为过期。如果调用类库在保存一个缓存项的时候未设置‘过期时间’、或者设置了 <code>null</code> 作为过期时间（或者 TTL 设置为 <code>null</code>），实现类库 <strong>可以</strong> 使用默认自行配置的一个时间。如果没有默认时间，实现类库 <strong>必须</strong> 把存储时间当做 <code>永久性</code> 存储，或者按照底层驱动能支持的最长时间作为保存时间。</li>
<li><strong>键（KEY）</strong> - 长度大于 1 的字符串，用作缓存项在缓存系统里的唯一标示。实现类库 <strong>必须</strong> 支持‘键’规则 <code>A-Z</code>、<code>a-z</code>、<code>0-9</code>、<code>_</code>、和 <code>.</code> 任何顺序的 UTF-8 编码，长度小于 64 位。实现类库 <strong>可以</strong> 支持更多的编码或者更长的长度，不过 <strong>必须</strong> 支持至少以上指定的编码和长度。实现类库可自行实现对‘键’的转义，但是 <strong>必须</strong> 保证能够无损的返回‘键’字串。以下的字串作为系统保留：<code>{}()/\@:</code>，<strong>一定不可</strong> 作为‘键’的命名支持。</li>
<li><strong>命中（Hit）</strong> - 一个缓存的命中，指的是当调用类库使用‘键’在请求一个缓存项的时候，在缓存池里能找到对应的缓存项，并且此缓存项还未过期，并且此数据不会因为任何原因出现错误。调用类库 <strong>应该</strong> 确保先验证下 <code>isHit()</code> 有命中后才调用 <code>get()</code> 获取数据。</li>
<li><strong>未命中（Miss）</strong> - 一个缓存未命中，是完全的上面描述的‘命中’的相反。指的是当调用类库使用‘键’在请求一个缓存项的时候，在缓存池里未能找到对应的缓存项，或者此缓存项已经过期，或者此数据因为任何原因出现错误。一个过期的缓存项，<strong>必须</strong> 被当做 <code>未命中</code> 来对待。</li>
<li><strong>延迟（Deferred）</strong> - 一个延迟的缓存，指的是这个缓存项可能不会立刻被存储到物理缓存池里。一个缓存池对象 <strong>可以</strong> 对一个指定延迟的缓存项进行延迟存储，这样做的好处是可以利用一些缓存服务器提供的批量插入功能。缓存池 <strong>必须</strong> 能对所有延迟缓存最终能持久化，并且不会丢失。<strong>可以</strong> 在调用类库还未发起保存请求之前就做持久化。当调用类库调用 <code>commit()</code> 方法时，所有的延迟缓存都 <strong>必须</strong> 做持久化。实现类库 <strong>可以</strong> 自行决定使用什么逻辑来触发数据持久化，如对象的 <code>析构方法（destructor）</code>内、调用 <code>save()</code> 时持久化、倒计时保存或者触发及最大数量时保存等。当请求一个延迟缓存项时，<strong>必须</strong> 返回一个延迟，未持久化的缓存对象。</li>
</ul>
<h3 id="数据"><a href="#数据" class="headerlink" title="数据"></a>数据</h3><p>实现类库 <strong>必须</strong> 支持所有的可序列化的 PHP 数据类型，包括：</p>
<ul>
<li><strong>字符串</strong> - 任何大小的 PHP 兼容字符串</li>
<li><strong>整数</strong> - PHP 支持的低于 64 位的有符号整数值</li>
<li><strong>浮点数</strong> - 所有的有符号浮点数</li>
<li><strong>布尔</strong> - true 和 false</li>
<li><strong>Null</strong> - <code>null</code> 值</li>
<li><strong>数组</strong> - 各种形式的 PHP 数组</li>
<li><strong>对象（Object）</strong> - 所有的支持无损序列化和反序列化的对象，如： <code>$o == unserialize(serialize($o))</code>。对象 <strong>可以</strong> 使用 PHP 的 <code>Serializeable</code> 接口，<code>__sleep()</code> 或者 <code>__wakeup()</code> 魔术方法，或者在合适的情况下，使用其他类似的语言特性。</li>
</ul>
<p>所有存进实现类库的数据，都 <code>必须</code> 能做到原封不动的取出。连类型也 <strong>必须</strong> 是完全一致，如果存进缓存的是字符串 5，取出来的却是整数值 5 的话，可以算作严重的错误。实现类库 <strong>可以</strong> 使用 PHP 的 ‘serialize()/unserialize()’ 方法作为底层的实现，不过不强迫这样做。对于他们的兼容性，以能支持所有数据类型作为基准线。<br>实在无法‘完整取出’存入的数据的话，实现类库 <strong>必须</strong> 把‘缓存丢失’标识作为返回，而不是损坏了的数据。</p>
<h2 id="主要概念"><a href="#主要概念" class="headerlink" title="主要概念"></a>主要概念</h2><h3 id="缓存池-Pool"><a href="#缓存池-Pool" class="headerlink" title="缓存池 Pool"></a>缓存池 Pool</h3><p>缓存池包含缓存系统里所有缓存数据的集合。缓存池逻辑上是所有缓存项存储的仓库，所有存储进去的数据，都能从缓存池里取出来，所有的对缓存的操作，都发生在缓存池子里。</p>
<h3 id="缓存项-Items"><a href="#缓存项-Items" class="headerlink" title="缓存项 Items"></a>缓存项 Items</h3><p>一条缓存项在缓存池里代表了一对‘键值’对应的数据，‘键’被视为每一个缓存项的主键，是缓存项的唯一标识符，<strong>必须</strong> 是不可变更的，当然‘值’<strong>可以</strong> 任意变更。</p>
<h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><p>缓存对应性能起着至关重要的作用，但是，无论在任何情况下，缓存 <strong>一定不可</strong> 作为应用程序不可或缺的核心功能。<br>缓存系统里的错误 <strong>一定不可</strong> 导致应用程序故障，所以类库 <strong>一定不可</strong> 抛出任何除了此接口规范定义的以外的异常，并且 <strong>必须</strong> 捕获包括底层存储驱动抛出的异常，不让其冒泡至超出缓存系统内。<br>实现类库 <strong>应该</strong> 对此类错误进行记录，或者以任何形式通知管理员。<br>调用类库发起删除缓存的请求，或者清空整个缓冲池子的请求，‘键’不存在的话 <strong>必须</strong> 不能当成是有错误发生。后置条件是一样的，如果取数据时，‘键’不存在的话 <strong>必须</strong> 不能当成是有错误发生。</p>
<h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><p><code>CacheIemInterface</code> 定义了缓存系统里的一个缓存项。每一个缓存项 <strong>必须</strong> 有一个‘键’与之相关联，此‘键’通常是通过 Cache\CacheItemPoolInterface 来设置。<br>Cache\CacheItemInterface 对象把缓存项的存储进行了封装，每一个 Cache\CacheItemInterface 由一个 Cache\CacheItemPoolInterface 对象生成，CacheItemPoolInterface 负责一些必须的设置，并且给对象设置具有 <code>唯一性</code> 的‘键’。<br>Cache\CacheItemInterface 对象 <strong>必须</strong> 能够存储和取出任何数据，在‘数据’章节定义的 PHP 的数值。<br>调用类库 <strong>一定不可</strong> 擅自初始化 ‘CacheItemInterface’ 对象，‘缓存项’只能使‘CacheItemPoolInterface’对象的 <code>getItem()</code> 方法来获取。调用类库 <strong>一定不可</strong> 假设由一个实现类库创建的‘缓存项’能被另一个实现类库完全兼容。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">namespace</span> <span class="title">Psr</span>\<span class="title">Cache</span>;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * CacheItemInterface 定了缓存系统里对缓存项操作的接口</span></div><div class="line"><span class="comment"> */</span></div><div class="line"> <span class="class"><span class="keyword">interface</span> <span class="title">CacheItemInterface</span></span></div><div class="line"><span class="class"> </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 返回当前缓存项的‘键’</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * ‘键’由实现类库来加载，并且高层的调用者（如：CacheItemPoolInterface）</span></div><div class="line"><span class="comment">     * **应该** 能使用此方法来获取到‘键’的信息</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> string 当前缓存项的‘键’</span></div><div class="line"><span class="comment">     */</span></div><div class="line">     <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getKey</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">     <span class="comment">/**</span></div><div class="line"><span class="comment">      * 凭借此缓存项的‘键’从缓存系统里面取出缓存项。</span></div><div class="line"><span class="comment">      *</span></div><div class="line"><span class="comment">      * 取出的数据 **必须** 跟使用 `set()` 存进去的数据是一模一样的。</span></div><div class="line"><span class="comment">      * </span></div><div class="line"><span class="comment">      * 如果 `isHit()` 返回 false 的话，此方法必须返回 `null`，需要注意的是 `null`</span></div><div class="line"><span class="comment">      * 本来就是一个合法的缓存数据，所以你 **应该** 使用 `isHit()` 方法来判别到底是</span></div><div class="line"><span class="comment">      * ‘返回 null 的数据’还是‘缓存里没有此数据’。</span></div><div class="line"><span class="comment">      *</span></div><div class="line"><span class="comment">      * <span class="doctag">@return</span> mixed 此缓存项的‘键’对应的‘值’，如果找不到的话，返回 `null`</span></div><div class="line"><span class="comment">      */</span></div><div class="line">     <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">     <span class="comment">/**</span></div><div class="line"><span class="comment">      * 确认缓存项的检查是否命中。</span></div><div class="line"><span class="comment">      *</span></div><div class="line"><span class="comment">      * 注意：调用此方法和调用 `get()` 时 **一定不可** 有先后顺序之分。</span></div><div class="line"><span class="comment">      *</span></div><div class="line"><span class="comment">      * <span class="doctag">@return</span> bool 如果缓冲池里有命中的话，返回 `true`，反之返回 `false`</span></div><div class="line"><span class="comment">      */</span></div><div class="line">      <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isHit</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">      <span class="comment">/**</span></div><div class="line"><span class="comment">       * 为此缓存项设置‘值’</span></div><div class="line"><span class="comment">       *</span></div><div class="line"><span class="comment">       * 参数 $value 可以是所有能被 PHP 序列化的数据，序列化的逻辑</span></div><div class="line"><span class="comment">       * 需要在实现类库里书写。</span></div><div class="line"><span class="comment">       * </span></div><div class="line"><span class="comment">       * <span class="doctag">@param</span> mixed $value 将被存储的可序列化的数据。</span></div><div class="line"><span class="comment">       * <span class="doctag">@return</span> 返回当前对象</span></div><div class="line"><span class="comment">       */</span></div><div class="line">       <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">set</span><span class="params">($value)</span></span>;</div><div class="line"></div><div class="line">       <span class="comment">/**</span></div><div class="line"><span class="comment">        * 设置缓存项的准确过期时间点。</span></div><div class="line"><span class="comment">        *</span></div><div class="line"><span class="comment">        * <span class="doctag">@param</span> \DateTimeInterface $expiration</span></div><div class="line"><span class="comment">        *</span></div><div class="line"><span class="comment">        * 过期的准确时间点，过了这个时间点后，缓存项就 **必须** 被认为是过期了的。</span></div><div class="line"><span class="comment">        * 如果明确的传参 `null` 的话， **可以** 使用一个默认的时间。</span></div><div class="line"><span class="comment">        * 如果没有设置的话，缓存 **应该** 存储到底层实现的最大化允许时间。</span></div><div class="line"><span class="comment">        * </span></div><div class="line"><span class="comment">        * <span class="doctag">@return</span> static 返回当前对象</span></div><div class="line"><span class="comment">        */</span></div><div class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">expiresAt</span><span class="params">($expiration)</span></span>;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line"><span class="comment">         * 设置缓存项的过期时间。</span></div><div class="line"><span class="comment">         * </span></div><div class="line"><span class="comment">         * <span class="doctag">@param</span> int | \DateInterval $time</span></div><div class="line"><span class="comment">         *  以秒为单位的过期时长，过了这段时间后，缓存项就 **必须** 被认为是过期了的。</span></div><div class="line"><span class="comment">         *  如果明确的传参 `null` 的话， **可以** 使用一个默认的时间。</span></div><div class="line"><span class="comment">         *  如果没有设置的话，缓存 **应该** 存储到底层实现的最大允许时间。</span></div><div class="line"><span class="comment">         *</span></div><div class="line"><span class="comment">         *  <span class="doctag">@return</span> static 返回当前对象</span></div><div class="line"><span class="comment">         */</span></div><div class="line">         <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">expiresAfter</span><span class="params">($time)</span></span>;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<h3 id="CacheItemPoolInterface"><a href="#CacheItemPoolInterface" class="headerlink" title="CacheItemPoolInterface"></a>CacheItemPoolInterface</h3><p>Cache\CacheItemPoolInterface 的主要目的是从调用类库接收‘键’，然后返回对应的 Cache\CacheItemInterface 对象。<br>此接口也是作为主要的，与整个缓存集合交互的方式。所有的配置和初始化由实现类库自行实现。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">namespace</span> <span class="title">Psr</span>\<span class="title">Cache</span>;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * CacheItemPoolInterface 生成 CacheItemInterface 对象</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">CacheItemPoolInterface</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 返回‘键’对应的一个缓存项。</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * 此方法 **必须** 返回一个 CacheItemInterface 对象，即使是找不到对应的缓存项</span></div><div class="line"><span class="comment">     * 也 **一定不可** 返回 `null`。</span></div><div class="line"><span class="comment">     *</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> string $key 用来搜索缓存项的‘键’</span></div><div class="line"><span class="comment">     * <span class="doctag">@throws</span> InvalidAraumentException</span></div><div class="line"><span class="comment">     *   如果 $key 不是合法的值，\Psr\Cache\InvalidArgumentException 异常会被抛出。</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span> CacheItemInterface 对应的缓存想</span></div><div class="line"><span class="comment">     */</span></div><div class="line">     <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getItem</span><span class="params">($key)</span></span>;</div><div class="line"></div><div class="line">     <span class="comment">/**</span></div><div class="line"><span class="comment">      * 返回一个可供遍历的缓存项集合。</span></div><div class="line"><span class="comment">      * </span></div><div class="line"><span class="comment">      * <span class="doctag">@param</span> array $keys 由一个或多个‘键’组成的数组。</span></div><div class="line"><span class="comment">      *</span></div><div class="line"><span class="comment">      * <span class="doctag">@throw</span> InvalidArgumentException</span></div><div class="line"><span class="comment">      *   如果 $keys 里面有哪个‘键’不合法，\Psr\Cache\InvalidArgumentException 异常会被抛出。</span></div><div class="line"><span class="comment">      *</span></div><div class="line"><span class="comment">      * <span class="doctag">@return</span> array | \Traversable</span></div><div class="line"><span class="comment">      *   返回一个可供遍历的缓存项集合，集合里每个元素的标识符由‘键’组成，即使是找不到对的</span></div><div class="line"><span class="comment">      *   缓存项，也要返回一个‘CacheItemInterface’对象到对应的‘键’中。</span></div><div class="line"><span class="comment">      *   如果传参的数组为空，也需要返回一个空的可遍历的集合。</span></div><div class="line"><span class="comment">      */</span></div><div class="line">      <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getItems</span><span class="params">(array $keys = array<span class="params">()</span>)</span></span>;</div><div class="line"></div><div class="line">      <span class="comment">/**</span></div><div class="line"><span class="comment">       * 检查缓存系统中是否有‘键’对应的缓存项。</span></div><div class="line"><span class="comment">       * </span></div><div class="line"><span class="comment">       * 注意：此方法应该调用 `CacheItemInterface::isHit()` 来做操作检查，而不是</span></div><div class="line"><span class="comment">       * `CacheItemInterface::get()`</span></div><div class="line"><span class="comment">       *</span></div><div class="line"><span class="comment">       * <span class="doctag">@param</span> string $key 用来搜索缓存项的‘键’。</span></div><div class="line"><span class="comment">       *</span></div><div class="line"><span class="comment">       * <span class="doctag">@throws</span> InvalidArgumentException</span></div><div class="line"><span class="comment">       *  如果 $key 不是合法的值，\Psr\Cache\InvalidArgumentException 异常会被抛出。</span></div><div class="line"><span class="comment">       *</span></div><div class="line"><span class="comment">       * <span class="doctag">@return</span> bool 如果存在‘键’对应的缓存项即返回 true, 否则 false</span></div><div class="line"><span class="comment">       */</span></div><div class="line">      <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">hasItem</span><span class="params">($key)</span></span>;</div><div class="line"></div><div class="line">      <span class="comment">/**</span></div><div class="line"><span class="comment">       * 清空缓冲池</span></div><div class="line"><span class="comment">       *</span></div><div class="line"><span class="comment">       * <span class="doctag">@return</span> bool 成果返回 true，有错误发生返回 false</span></div><div class="line"><span class="comment">       */</span></div><div class="line">       <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">clear</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">       <span class="comment">/**</span></div><div class="line"><span class="comment">        * 从缓冲池里移除某个缓存项</span></div><div class="line"><span class="comment">        *</span></div><div class="line"><span class="comment">        * <span class="doctag">@param</span> string $key 用来搜索缓存项的‘键’</span></div><div class="line"><span class="comment">        *</span></div><div class="line"><span class="comment">        * <span class="doctag">@throws</span> InvalidArgumentException</span></div><div class="line"><span class="comment">        *    如果 $key 不是合法的值，\Psr\Cache\InvalidArgumentException 异常会被抛出。</span></div><div class="line"><span class="comment">        *</span></div><div class="line"><span class="comment">        * <span class="doctag">@return</span> bool 成功返回 true，有错误发生返回 false</span></div><div class="line"><span class="comment">        */</span></div><div class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">deleteItem</span><span class="params">($key)</span></span>;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line"><span class="comment">         * 从缓冲池里移除多个缓存项</span></div><div class="line"><span class="comment">         *</span></div><div class="line"><span class="comment">         * <span class="doctag">@param</span> array $keys 由一个或者多个‘键’组成的数组。</span></div><div class="line"><span class="comment">         *</span></div><div class="line"><span class="comment">         * <span class="doctag">@throws</span> InvalidArgumentException</span></div><div class="line"><span class="comment">         *   如果 $keys 里面有哪个‘键’不是合法，\Psr\Cache\InvalidArgumentException 异常会被抛出</span></div><div class="line"><span class="comment">         * <span class="doctag">@return</span> bool 成功返回 true，有错误发生返回 false</span></div><div class="line"><span class="comment">         */</span></div><div class="line">         <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">deleteItems</span><span class="params">(array $keys)</span></span>;</div><div class="line"></div><div class="line">         <span class="comment">/**</span></div><div class="line"><span class="comment">          * 立刻为 ‘CacheItemInterface' 对象做数据持久化。</span></div><div class="line"><span class="comment">          * </span></div><div class="line"><span class="comment">          * <span class="doctag">@param</span> CacheItemInterface $item 将要被存储的缓存项</span></div><div class="line"><span class="comment">          *</span></div><div class="line"><span class="comment">          * <span class="doctag">@return</span> bool 成功返回 true，有错误发生返回 false</span></div><div class="line"><span class="comment">          */</span></div><div class="line">          <span class="keyword">public</span> funciton save(CacheItemInterface $item);</div><div class="line"></div><div class="line">          <span class="comment">/**</span></div><div class="line"><span class="comment">           * 稍后为 ‘CacheItemInterface’ 对象做数据持久化。</span></div><div class="line"><span class="comment">           *</span></div><div class="line"><span class="comment">           * <span class="doctag">@param</span> CacheItemInterface $item 将要被存储的缓存项</span></div><div class="line"><span class="comment">           *</span></div><div class="line"><span class="comment">           * <span class="doctag">@return</span> bool 成功返回 true，有错误发生返回 false</span></div><div class="line"><span class="comment">           */</span></div><div class="line">           <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">saveDeferred</span><span class="params">(CacheItemInterface $item)</span></span>;</div><div class="line"></div><div class="line">           <span class="comment">/**</span></div><div class="line"><span class="comment">            * 提交所有的正在队列里等待的请求到数据持久层，配合 `saveDeferred()` 使用</span></div><div class="line"><span class="comment">            *</span></div><div class="line"><span class="comment">            * <span class="doctag">@return</span> bool 成功返回 true，有错误发生返回 false</span></div><div class="line"><span class="comment">            */</span></div><div class="line">            <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">commit</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="CacheException"><a href="#CacheException" class="headerlink" title="CacheException"></a>CacheException</h3><p>此异常用于缓存系统发生的多有严重错误，包括但不限制于 <strong>缓存系统配置</strong>，如连接到缓存服务器出错、错误的用户身份认证等。<br>多有的实现类库抛出的异常都 <strong>必须</strong> 实现此接口。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">namespace</span> <span class="title">Psr</span>\<span class="title">Cache</span>;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 被所有的实现类库抛出的异常继承‘异常接口’</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">CacheException</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="InvalidArgumentException"><a href="#InvalidArgumentException" class="headerlink" title="InvalidArgumentException"></a>InvalidArgumentException</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">namespace</span> <span class="title">Psr</span>\<span class="title">Cache</span>;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * 传参错误抛出的异常接口</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * 当一个错误或者非法的传参发生时， **必须** 抛出一个继承了</span></div><div class="line"><span class="comment"> * Psr\Cache\InvalidArgumentException 的异常。</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">InvalidArgumentException</span> <span class="keyword">extends</span> <span class="title">CacheException</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>来自：<a href="https//psr.phphub.org">https://psr.phphub.org</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/7/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/9/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Dearmadman</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">100</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Dearmadman</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
